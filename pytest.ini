[pytest]
minversion = 8.0
# Note: si ta CI passe déjà --cov=..., tu peux retirer les 3 options --cov ci-dessous.
addopts = --cov=server/app --cov-config=.coveragerc --cov-report=term-missing -q -ra --strict-markers --strict-config --durations=20
testpaths =
    server/tests
pythonpath =
    .
    server
markers =
    unit: fast unit tests / tests unitaires rapides (no external services)
    integration: tests requiring DB/Redis/API/worker / tests avec Postgres/Redis (services)
    e2e: end-to-end tests on full stack / tests bout-à-bout (stack docker up)
    timeout: limite par test (secondes) fournie par pytest-timeout
filterwarnings =
    ignore::DeprecationWarning
timeout = 60
timeout_method = thread
timeout_func_only = true
env =
  STUB_SLACK=1
  SLACK_WEBHOOK=http://httpbin:80/status/204
  CELERY_TASK_ALWAYS_EAGER=1
  ALERT_REMINDER_MINUTES=1