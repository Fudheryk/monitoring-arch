
################################################################################
#  SC√âNARIO MATRICE ALERTES / NO-DATA (cpu.usage_percent + memory.usage_percent)
#  Machine : debian-dev
#  Client  : Dev
#  Fingerprint : f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1
################################################################################

################################################################################
#  SC√âNARIO : 0 - Configuration initiale (SETUP)
################################################################################

üîß Configuration initiale de la machine et des seuils...

################################################################################
INGEST [setup-initial] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:setup-initial"
}
[CHECK OK]   Ingestion 'setup-initial'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*)     FROM metric_instances     WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )       AND name_effective IN ('cpu.usage_percent','memory.usage_percent');
================================================================================
2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*)     FROM metric_instances     WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )       AND name_effective IN ('cpu.usage_percent','memory.usage_percent'); (exit_code=0)
[CHECK OK]   metric_instances cr√©√©es (cpu+mem): count=2 (>= 2)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c CREATE EXTENSION IF NOT EXISTS pgcrypto;
================================================================================
CREATE EXTENSION
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c CREATE EXTENSION IF NOT EXISTS pgcrypto; (exit_code=0)

üîß ACTIVATION DE L'ALERTING SUR LES M√âTRIQUES

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') );
================================================================================
UPDATE 2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO client_settings (client_id, created_at, updated_at) SELECT id, NOW(), NOW() FROM clients WHERE name = 'Dev'   AND NOT EXISTS (     SELECT 1 FROM client_settings cs     WHERE cs.client_id = clients.id   );
================================================================================
INSERT 0 0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO client_settings (client_id, created_at, updated_at) SELECT id, NOW(), NOW() FROM clients WHERE name = 'Dev'   AND NOT EXISTS (     SELECT 1 FROM client_settings cs     WHERE cs.client_id = clients.id   ); (exit_code=0)

üîß CR√âATION DU SEUIL POUR cpu.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent';
================================================================================
639aeb24-bfb5-40b0-9743-f9b73e32101d
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '639aeb24-bfb5-40b0-9743-f9b73e32101d' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '639aeb24-bfb5-40b0-9743-f9b73e32101d' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour cpu.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '639aeb24-bfb5-40b0-9743-f9b73e32101d',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '639aeb24-bfb5-40b0-9743-f9b73e32101d',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT cpu.usage_percent

üîß CR√âATION DU SEUIL POUR memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent';
================================================================================
53e49042-dedc-4756-bdc5-b2580e292469
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '53e49042-dedc-4756-bdc5-b2580e292469' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '53e49042-dedc-4756-bdc5-b2580e292469' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour memory.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '53e49042-dedc-4756-bdc5-b2580e292469',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '53e49042-dedc-4756-bdc5-b2580e292469',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET reminder_notification_seconds = 5,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET reminder_notification_seconds = 5,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 17:49:16+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 17:49:16+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

‚öôÔ∏è  SEUILS CONFIGUR√âS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name;
================================================================================
                  id                  |    name_effective    |  name   | condition | value_num | severity | is_active |          created_at           
--------------------------------------+----------------------+---------+-----------+-----------+----------+-----------+-------------------------------
 bc065bb0-7cf7-4550-b3ee-a7664561bf07 | cpu.usage_percent    | default | gt        |        80 | warning  | t         | 2026-01-03 17:49:21.197118+00
 8039a1d8-6313-4e0d-92c8-fefedca8d3e9 | memory.usage_percent | default | gt        |        85 | warning  | t         | 2026-01-03 17:49:23.016688+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name; (exit_code=0)

>>> R√©sultat du sc√©nario '0 - Configuration initiale (SETUP)': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 1 - Onboarding CPU
################################################################################

################################################################################
INGEST [cpu-onboarding-1] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 42
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:cpu-onboarding-1"
}
[CHECK OK]   Ingestion 'cpu-onboarding-1'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser l'ingestion √™tre trait√©e
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 17:49:25+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 17:49:16+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
 id | threshold_id | machine_id | metric_instance_id | status | severity | current_value | triggered_at | resolved_at | created_at 
----+--------------+------------+--------------------+--------+----------+---------------+--------------+-------------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
 id | client_id | incident_id | alert_id | provider | recipient | status | message | sent_at | created_at 
----+-----------+-------------+----------+----------+-----------+--------+---------+---------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '1 - Onboarding CPU': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 2 - NO-DATA machine DOWN
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: laisser NO-DATA se d√©clencher (machine DOWN)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 17:49:25+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 17:49:16+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                   title                    | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------------+----------+--------+-------------------------------+-------------
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e | critical | OPEN   | 2026-01-03 17:54:55.539151+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                   title                    | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------------+----------+--------+-------------------------------+-------------
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e | critical | OPEN   | 2026-01-03 17:54:55.539151+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                   message                                   |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+-----------------------------------------------------------------------------+-------------------------------+-------------------------------
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                |                               | 
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '2 - NO-DATA machine DOWN': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 3 - Restauration compl√®te machine
################################################################################

################################################################################
INGEST [cpu-restore-full] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:cpu-restore-full"
}
[CHECK OK]   Ingestion 'cpu-restore-full'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser freshness/evaluate traiter la restauration
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 30.0       | 2026-01-03 17:55:50+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 17:49:16+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 17:55:55.534249+00 | 
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 17:55:55.534249+00 | 
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                       message                                                        |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                        +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                               |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                        +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                               |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                         |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                         |                               | 
(6 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '3 - Restauration compl√®te machine': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 4 - Ajout memory.usage_percent
################################################################################

################################################################################
INGEST [cpu-mem-onboarding] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 35
    },
    {
      "name": "memory.usage_percent",
      "value": 40
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:cpu-mem-onboarding"
}
[CHECK OK]   Ingestion 'cpu-mem-onboarding'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de l'ingestion CPU+MEM
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 17:56:53+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 17:56:53+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(8 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '4 - Ajout memory.usage_percent': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 5 - NO-DATA global puis restauration partielle
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: NO-DATA global (CPU + MEM)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 17:56:53+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 17:56:53+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-03 18:01:55.562514+00 | 
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-03 18:01:55.562514+00 | 
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 1da68c4a-f786-496d-ba2b-14a4919837ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.186224+00 | 2026-01-03 18:01:56.187155+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 e3dcb092-b1c7-46f0-bb2f-4ef5e777d19a | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.162983+00 | 2026-01-03 18:01:56.164866+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(10 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

################################################################################
INGEST [cpu-only-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:cpu-only-restore"
}
[CHECK OK]   Ingestion 'cpu-only-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration partielle
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 25.0       | 2026-01-03 18:03:18+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 17:56:53+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 82a15149-b1d8-4649-9cbd-4c469b034b7e | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 18:03:55.574213+00 | 
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 18:01:55.562514+00 | 2026-01-03 18:03:55.567559+00
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 82a15149-b1d8-4649-9cbd-4c469b034b7e | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 18:03:55.574213+00 | 
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 18:01:55.562514+00 | 2026-01-03 18:03:55.567559+00
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 02a77c6b-d6fc-431b-a9ad-03a4deb312c4 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.122634+00 | 2026-01-03 18:03:56.123603+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 ab870ad5-5e02-4616-92b9-399c93f436ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.096572+00 | 2026-01-03 18:03:56.109658+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 7bc790db-5b03-4a3c-b991-e30c72205af1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.058452+00 | 2026-01-03 18:03:56.060831+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 12f1ca8b-c244-425c-8bf8-082ce4b9d698 | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.049098+00 | 2026-01-03 18:03:56.049853+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1da68c4a-f786-496d-ba2b-14a4919837ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.186224+00 | 2026-01-03 18:01:56.187155+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 e3dcb092-b1c7-46f0-bb2f-4ef5e777d19a | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.162983+00 | 2026-01-03 18:01:56.164866+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(14 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '5 - NO-DATA global puis restauration partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 6 - Restauration compl√®te apr√®s partielle
################################################################################

################################################################################
INGEST [cpu-mem-full-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 27
    },
    {
      "name": "memory.usage_percent",
      "value": 35
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:cpu-mem-full-restore"
}
[CHECK OK]   Ingestion 'cpu-mem-full-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration compl√®te
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 27.0       | 2026-01-03 18:04:23+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 35.0       | 2026-01-03 18:04:23+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 82a15149-b1d8-4649-9cbd-4c469b034b7e | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 18:03:55.574213+00 | 2026-01-03 18:04:55.521632+00
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 18:01:55.562514+00 | 2026-01-03 18:03:55.567559+00
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 82a15149-b1d8-4649-9cbd-4c469b034b7e | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 18:03:55.574213+00 | 2026-01-03 18:04:55.521632+00
 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 18:01:55.562514+00 | 2026-01-03 18:03:55.567559+00
 bd374f5e-58c0-4e7c-9519-2703bdc529af | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 17:55:55.534249+00 | 2026-01-03 17:56:55.522342+00
 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 17:54:55.539151+00 | 2026-01-03 17:55:55.513507+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donn√©e envoy√©e%'      OR title LIKE '%M√©trique donn√©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 12beb749-ae7a-493f-9d4a-6757a191c903 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.042585+00 | 2026-01-03 18:04:56.043307+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 76e227ca-d72a-4517-97f4-777b12c119f1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.024699+00 | 2026-01-03 18:04:56.02505+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 02a77c6b-d6fc-431b-a9ad-03a4deb312c4 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.122634+00 | 2026-01-03 18:03:56.123603+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 ab870ad5-5e02-4616-92b9-399c93f436ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.096572+00 | 2026-01-03 18:03:56.109658+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 7bc790db-5b03-4a3c-b991-e30c72205af1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |          | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.058452+00 | 2026-01-03 18:03:56.060831+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 12f1ca8b-c244-425c-8bf8-082ce4b9d698 | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.049098+00 | 2026-01-03 18:03:56.049853+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1da68c4a-f786-496d-ba2b-14a4919837ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.186224+00 | 2026-01-03 18:01:56.187155+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 e3dcb092-b1c7-46f0-bb2f-4ef5e777d19a | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.162983+00 | 2026-01-03 18:01:56.164866+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(16 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '6 - Restauration compl√®te apr√®s partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 7 - Seuil CPU d√©pass√©
################################################################################

################################################################################
INGEST [threshold-cpu-high] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:threshold-cpu-high"
}
[CHECK OK]   Ingestion 'threshold-cpu-high'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: √©valuation des seuils CPU high
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 95.0       | 2026-01-03 18:05:26+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 18:05:26+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                          title                           | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------+----------+--------+-------------------------------+-------------
 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : Seuil d√©pass√© sur cpu.usage_percent | warning  | OPEN   | 2026-01-03 18:05:26.274329+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          | status | severity | current_value |         triggered_at          | resolved_at |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+--------+----------+---------------+-------------------------------+-------------+-------------------------------
 5c9b2de4-04e3-4e3f-ae46-145aab07607b | bc065bb0-7cf7-4550-b3ee-a7664561bf07 | 36550276-0360-4bed-b38b-c97942b195c7 | 639aeb24-bfb5-40b0-9743-f9b73e32101d | FIRING | warning  | 95.0          | 2026-01-03 18:05:26.270008+00 |             | 2026-01-03 18:05:26.271331+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 e9178bb7-5a5a-4e93-9f23-3361bfe6061b | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.868903+00 | 2026-01-03 18:05:26.872445+00
 1c6d151c-b43c-4ef0-bc60-23a6bd538a70 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | slack    | #notif-webhook               | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.828015+00 | 2026-01-03 18:05:26.828572+00
 12beb749-ae7a-493f-9d4a-6757a191c903 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.042585+00 | 2026-01-03 18:04:56.043307+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 76e227ca-d72a-4517-97f4-777b12c119f1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.024699+00 | 2026-01-03 18:04:56.02505+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 02a77c6b-d6fc-431b-a9ad-03a4deb312c4 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.122634+00 | 2026-01-03 18:03:56.123603+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 ab870ad5-5e02-4616-92b9-399c93f436ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.096572+00 | 2026-01-03 18:03:56.109658+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 7bc790db-5b03-4a3c-b991-e30c72205af1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.058452+00 | 2026-01-03 18:03:56.060831+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 12f1ca8b-c244-425c-8bf8-082ce4b9d698 | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.049098+00 | 2026-01-03 18:03:56.049853+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1da68c4a-f786-496d-ba2b-14a4919837ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.186224+00 | 2026-01-03 18:01:56.187155+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 e3dcb092-b1c7-46f0-bb2f-4ef5e777d19a | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.162983+00 | 2026-01-03 18:01:56.164866+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(18 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold OPEN exactly 1 (cpu.usage_percent): count=1 (expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte FIRING exactly 1 (cpu.usage_percent): count=1 (expected=1)

################################################################################
INGEST [threshold-cpu-high-repeat] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 96
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:threshold-cpu-high-repeat"
}
[CHECK OK]   Ingestion 'threshold-cpu-high-repeat'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: re-check seuil (doit r√©utiliser l'incident)
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold OPEN exactly 1 (cpu.usage_percent): count=1 (expected=1)

>>> R√©sultat du sc√©nario '7 - Seuil CPU d√©pass√©': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 8 - Seuils revenus √† la normale
################################################################################

################################################################################
INGEST [threshold-all-ok] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:threshold-all-ok"
}
[CHECK OK]   Ingestion 'threshold-all-ok'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: r√©solution des alertes de seuil
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 639aeb24-bfb5-40b0-9743-f9b73e32101d | 36550276-0360-4bed-b38b-c97942b195c7 | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 18:07:31+00
 53e49042-dedc-4756-bdc5-b2580e292469 | 36550276-0360-4bed-b38b-c97942b195c7 | memory.usage_percent | t                   | t               | f         | 25.0       | 2026-01-03 18:07:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                          title                           | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 661955eb-0494-4685-887c-f928f6ddab9f | 36550276-0360-4bed-b38b-c97942b195c7 | Machine debian-dev : Seuil d√©pass√© sur cpu.usage_percent | warning  | RESOLVED | 2026-01-03 18:05:26.274329+00 | 2026-01-03 18:07:31.130498+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil d√©pass√© sur %' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          |  status  | severity | current_value |         triggered_at          |          resolved_at          |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+---------------+-------------------------------+-------------------------------+-------------------------------
 5c9b2de4-04e3-4e3f-ae46-145aab07607b | bc065bb0-7cf7-4550-b3ee-a7664561bf07 | 36550276-0360-4bed-b38b-c97942b195c7 | 639aeb24-bfb5-40b0-9743-f9b73e32101d | RESOLVED | warning  | 95.0          | 2026-01-03 18:05:26.270008+00 | 2026-01-03 18:07:31.114327+00 | 2026-01-03 18:05:26.271331+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 a97f430f-66a1-4e8c-b322-9d37aa29b3f7 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 18:07:31.654048+00 | 2026-01-03 18:07:31.655283+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 3d9ebcc3-eb42-4f83-b4c2-9d25b6c0fba0 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 18:07:31.632484+00 | 2026-01-03 18:07:31.63285+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 e9178bb7-5a5a-4e93-9f23-3361bfe6061b | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.868903+00 | 2026-01-03 18:05:26.872445+00
 1c6d151c-b43c-4ef0-bc60-23a6bd538a70 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | slack    | #notif-webhook               | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.828015+00 | 2026-01-03 18:05:26.828572+00
 12beb749-ae7a-493f-9d4a-6757a191c903 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.042585+00 | 2026-01-03 18:04:56.043307+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 76e227ca-d72a-4517-97f4-777b12c119f1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.024699+00 | 2026-01-03 18:04:56.02505+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 02a77c6b-d6fc-431b-a9ad-03a4deb312c4 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.122634+00 | 2026-01-03 18:03:56.123603+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 ab870ad5-5e02-4616-92b9-399c93f436ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.096572+00 | 2026-01-03 18:03:56.109658+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 7bc790db-5b03-4a3c-b991-e30c72205af1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.058452+00 | 2026-01-03 18:03:56.060831+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 12f1ca8b-c244-425c-8bf8-082ce4b9d698 | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.049098+00 | 2026-01-03 18:03:56.049853+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1da68c4a-f786-496d-ba2b-14a4919837ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.186224+00 | 2026-01-03 18:01:56.187155+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 e3dcb092-b1c7-46f0-bb2f-4ef5e777d19a | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 18:01:56.162983+00 | 2026-01-03 18:01:56.164866+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 302s (seuil 300s).                                                                                                                                       |                               | 
 7a1953fc-733a-49b1-a2be-ddd327695fff | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.03729+00  | 2026-01-03 17:56:56.038274+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 c9da9dd5-7f9a-45a9-bbd2-ad4b286d319c | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 17:56:56.008921+00 | 2026-01-03 17:56:56.010501+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                    |                               | 
 bec8719e-6c59-42ec-be69-489285effdf8 | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.074866+00 | 2026-01-03 17:55:56.07674+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 cdeabf2b-a1c8-4394-a94e-276576e86aaa | 661955eb-0494-4685-887c-f928f6ddab9f | bd374f5e-58c0-4e7c-9519-2703bdc529af |                                      | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 17:55:56.053261+00 | 2026-01-03 17:55:56.056079+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:49:16+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 399s (seuil 300s)                                                                                                                                                             |                               | 
 5b4f8ebd-4873-402b-b9d1-5ddb3ae21719 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:56.024479+00 | 2026-01-03 17:55:56.027411+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 c12d59c9-0fa5-4b7f-9c4f-623a135ce204 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | slack    | #notif-webhook               | success | (#001) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 17:55:55.997775+00 | 2026-01-03 17:55:55.999064+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b2639574-14b7-49f5-9a70-53e1ab9353d1 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.108634+00 | 2026-01-03 17:54:56.110615+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
 f466627f-eac1-41ac-a654-80a4ae50e5a3 | 661955eb-0494-4685-887c-f928f6ddab9f | 0a4a1464-c0c5-43cc-8e92-e1bda7dc7e89 |                                      | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 17:54:56.065342+00 | 2026-01-03 17:54:56.068707+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 339s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil d√©pass√© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold NOT OPEN (cpu.usage_percent): count=0 (expected=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte NOT FIRING (cpu.usage_percent): count=0 (expected=0)

>>> R√©sultat du sc√©nario '8 - Seuils revenus √† la normale': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 9 - Email rappel incidents ouverts
################################################################################

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM clients WHERE name = 'Dev' LIMIT 1;
================================================================================
661955eb-0494-4685-887c-f928f6ddab9f
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM clients WHERE name = 'Dev' LIMIT 1; (exit_code=0)

################################################################################
INGEST [reminder-open-breach] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_184916_9952476b:reminder-open-breach"
}
[CHECK OK]   Ingestion 'reminder-open-breach'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: ouvrir un incident (pr√©condition reminder)
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'; (exit_code=0)
[CHECK OK]   Pr√©condition: au moins 1 incident OPEN: count=1 (min_expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM incidents WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN' ORDER BY created_at DESC LIMIT 1;
================================================================================
cdea47fa-d137-416e-b50b-c0ce0aa0f6ec
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM incidents WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN' ORDER BY created_at DESC LIMIT 1; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 1', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 18:09:41,916 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 1', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
4
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Notif non-group√©e: trace slack/email/system (incident_id): count=4 (>= 1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 2 (should cooldown)', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 18:09:52,087 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 2 (should cooldown)', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK FAIL] Notif non-group√©e: skipped_cooldown (incident_id): timeout after 90s (last_count=0)

--------------------------------------------------------------------------------
‚è±  Attente 7s pour: attendre > cooldown (5s) pour re-envoyer
--------------------------------------------------------------------------------
  ... 7 s restantes
‚è±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 3 (after cooldown)', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 18:11:35,975 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'üîî Rappel NON-GROUP√â (test e2e)', 'text': 'ping 3 (after cooldown)', 'severity': 'warning', 'client_id': '661955eb-0494-4685-887c-f928f6ddab9f', 'incident_id': 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
8
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND incident_id = 'cdea47fa-d137-416e-b50b-c0ce0aa0f6ec'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Notif non-group√©e: trace slack/email/system (incident_id): count=8 (>= 1)

--------------------------------------------------------------------------------
‚è±  Attente 6s pour: attendre > cooldown (5s) avant rappel group√©
--------------------------------------------------------------------------------
  ... 6 s restantes
‚è±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = TRUE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = TRUE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify_grouped_reminder; notify_grouped_reminder.delay('661955eb-0494-4685-887c-f928f6ddab9f')
================================================================================
STDERR: 2026-01-03 18:11:49,934 DEBUG celery.utils.functional 
def notify_grouped_reminder(client_id):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify_grouped_reminder; notify_grouped_reminder.delay('661955eb-0494-4685-887c-f928f6ddab9f') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND message ILIKE '%üîÅ Rappel d''incidents ouverts%'   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '661955eb-0494-4685-887c-f928f6ddab9f'   AND message ILIKE '%üîÅ Rappel d''incidents ouverts%'   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Rappel group√©: trace dans notification_log: count=2 (>= 1)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 1279e81c-22c1-4871-871c-6724370650f7 | 661955eb-0494-4685-887c-f928f6ddab9f |                                      |                                      | email    | frederic.gilgarcia@gmail.com | success | üîÅ Rappel d'incidents ouverts: üö® Rappel: incidents toujours ouverts                                                                                                              +| 2026-01-03 18:11:51.920647+00 | 2026-01-03 18:11:51.93012+00
                                      |                                      |                                      |                                      |          |                              |         | - (#006) Machine debian-dev : Seuil d√©pass√© sur cpu.usage_percent                                                                                                                  |                               | 
 281d18e5-5f48-42b1-8b11-52b588006e5a | 661955eb-0494-4685-887c-f928f6ddab9f |                                      |                                      | slack    | #notif-webhook               | success | üîÅ Rappel d'incidents ouverts: üö® Rappel: incidents toujours ouverts                                                                                                              +| 2026-01-03 18:11:51.803679+00 | 2026-01-03 18:11:51.806046+00
                                      |                                      |                                      |                                      |          |                              |         | - (#006) Machine debian-dev : Seuil d√©pass√© sur cpu.usage_percent                                                                                                                  |                               | 
 2b86df5f-5db2-402b-972f-995a177a1449 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 3 (after cooldown)                                                                                                                    | 2026-01-03 18:11:37.255194+00 | 2026-01-03 18:11:37.258447+00
 2a950f5b-0930-4b1d-917c-aafbaefd3be5 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | slack    | #notif-webhook               | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 3 (after cooldown)                                                                                                                    | 2026-01-03 18:11:37.065397+00 | 2026-01-03 18:11:37.091539+00
 18cc98b8-d6d1-46c0-938d-cfa1b3b758d0 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 2 (should cooldown)                                                                                                                   | 2026-01-03 18:09:53.425433+00 | 2026-01-03 18:09:53.433728+00
 f5da8cea-87c5-4a8a-8475-273e5bd6a5e8 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | slack    | #notif-webhook               | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 2 (should cooldown)                                                                                                                   | 2026-01-03 18:09:53.276378+00 | 2026-01-03 18:09:53.277731+00
 a801e477-f9bc-4052-9c6e-cdb365313965 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 1                                                                                                                                     | 2026-01-03 18:09:43.159331+00 | 2026-01-03 18:09:43.162837+00
 ba9e9ad2-9abc-4e29-b688-25310dd90e54 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec |                                      | slack    | #notif-webhook               | success | (#006) üîî Rappel NON-GROUP√â (test e2e): ping 1                                                                                                                                     | 2026-01-03 18:09:43.039112+00 | 2026-01-03 18:09:43.040139+00
 be15e8ae-4d06-4b33-a019-412b1ab83a89 | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec | add578a3-1e3d-4278-8acd-3214095a93bc | email    | frederic.gilgarcia@gmail.com | success | (#006) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:08:34.689257+00 | 2026-01-03 18:08:34.69034+00
 c85bb258-5aef-4278-9ec9-40c8b506209b | 661955eb-0494-4685-887c-f928f6ddab9f | cdea47fa-d137-416e-b50b-c0ce0aa0f6ec | add578a3-1e3d-4278-8acd-3214095a93bc | slack    | #notif-webhook               | success | (#006) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:08:34.675298+00 | 2026-01-03 18:08:34.675689+00
 a97f430f-66a1-4e8c-b322-9d37aa29b3f7 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 18:07:31.654048+00 | 2026-01-03 18:07:31.655283+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 3d9ebcc3-eb42-4f83-b4c2-9d25b6c0fba0 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 18:07:31.632484+00 | 2026-01-03 18:07:31.63285+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 e9178bb7-5a5a-4e93-9f23-3361bfe6061b | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.868903+00 | 2026-01-03 18:05:26.872445+00
 1c6d151c-b43c-4ef0-bc60-23a6bd538a70 | 661955eb-0494-4685-887c-f928f6ddab9f | 4e95ece2-6d22-462a-a0fd-defec9aa6d6f | 5c9b2de4-04e3-4e3f-ae46-145aab07607b | slack    | #notif-webhook               | success | (#005) üö® Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 18:05:26.828015+00 | 2026-01-03 18:05:26.828572+00
 12beb749-ae7a-493f-9d4a-6757a191c903 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.042585+00 | 2026-01-03 18:04:56.043307+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 76e227ca-d72a-4517-97f4-777b12c119f1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 18:04:56.024699+00 | 2026-01-03 18:04:56.02505+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T18:04:23+00:00                                                                                                                                    |                               | 
 02a77c6b-d6fc-431b-a9ad-03a4deb312c4 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.122634+00 | 2026-01-03 18:03:56.123603+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 ab870ad5-5e02-4616-92b9-399c93f436ba | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.096572+00 | 2026-01-03 18:03:56.109658+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 7bc790db-5b03-4a3c-b991-e30c72205af1 | 661955eb-0494-4685-887c-f928f6ddab9f | 82a15149-b1d8-4649-9cbd-4c469b034b7e |                                      | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-03 18:03:56.058452+00 | 2026-01-03 18:03:56.060831+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T17:56:53+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 422s (seuil 300s)                                                                                                                                                             |                               | 
 12f1ca8b-c244-425c-8bf8-082ce4b9d698 | 661955eb-0494-4685-887c-f928f6ddab9f | 33c7e0d8-0d18-4e4b-9f26-016fdbd402e7 |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 18:03:56.049098+00 | 2026-01-03 18:03:56.049853+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '9 - Email rappel incidents ouverts': FAIL ‚ùå


################################################################################
#  R√âSUM√â GLOBAL DES SC√âNARIOS
################################################################################

Sc√©narios ex√©cut√©s : 10
  - SUCCESS : 9
  - FAIL    : 1

  - 0 - Configuration initiale (SETUP): SUCCESS ‚úÖ
  - 1 - Onboarding CPU: SUCCESS ‚úÖ
  - 2 - NO-DATA machine DOWN: SUCCESS ‚úÖ
  - 3 - Restauration compl√®te machine: SUCCESS ‚úÖ
  - 4 - Ajout memory.usage_percent: SUCCESS ‚úÖ
  - 5 - NO-DATA global puis restauration partielle: SUCCESS ‚úÖ
  - 6 - Restauration compl√®te apr√®s partielle: SUCCESS ‚úÖ
  - 7 - Seuil CPU d√©pass√©: SUCCESS ‚úÖ
  - 8 - Seuils revenus √† la normale: SUCCESS ‚úÖ
  - 9 - Email rappel incidents ouverts: FAIL ‚ùå

--------------------------------------------------------------------------------
#  STATISTIQUES DES CHECKS (commandes HTTP/SQL)
--------------------------------------------------------------------------------
Checks totaux   : 108
Checks OK       : 107
Checks en √©chec : 1
Taux de succ√®s  : 99.07 %

#  FIN DU SC√âNARIO COMPLET
################################################################################

