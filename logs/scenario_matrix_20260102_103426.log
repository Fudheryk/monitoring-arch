
################################################################################
#  SC√âNARIO MATRICE ALERTES / NO-DATA (cpu.usage_percent + memory.usage_percent)
#  Machine : debian-dev
#  Client  : Dev
#  Fingerprint : f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1
################################################################################

################################################################################
#  SC√âNARIO : 0 - Configuration initiale (SETUP)
################################################################################

üîß Configuration initiale de la machine et des seuils...

################################################################################
INGEST [setup-initial] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:setup-initial"
}
[CHECK OK]   Ingestion 'setup-initial'

--------------------------------------------------------------------------------
‚è±  Attente 30s pour: cr√©ation des metric_instances
--------------------------------------------------------------------------------
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üîß ACTIVATION DE L'ALERTING SUR LES M√âTRIQUES

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') );
================================================================================
UPDATE 2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ); (exit_code=0)

üîß CR√âATION DU SEUIL POUR cpu.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent';
================================================================================
48117524-28ca-40ce-b1d8-68318e1ebf10
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '48117524-28ca-40ce-b1d8-68318e1ebf10' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '48117524-28ca-40ce-b1d8-68318e1ebf10' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour cpu.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '48117524-28ca-40ce-b1d8-68318e1ebf10',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '48117524-28ca-40ce-b1d8-68318e1ebf10',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT cpu.usage_percent

üîß CR√âATION DU SEUIL POUR memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent';
================================================================================
5950b70d-0e3e-451c-9fa1-ba6d20dad49a
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '5950b70d-0e3e-451c-9fa1-ba6d20dad49a' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '5950b70d-0e3e-451c-9fa1-ba6d20dad49a' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour memory.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '5950b70d-0e3e-451c-9fa1-ba6d20dad49a',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '5950b70d-0e3e-451c-9fa1-ba6d20dad49a',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT memory.usage_percent

üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-02 09:34:26+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 09:34:26+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

‚öôÔ∏è  SEUILS CONFIGUR√âS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name;
================================================================================
                  id                  |    name_effective    |  name   | condition | value_num | severity | is_active |          created_at           
--------------------------------------+----------------------+---------+-----------+-----------+----------+-----------+-------------------------------
 850aa358-8949-41b4-aa13-fb6ac4e8a486 | cpu.usage_percent    | default | gt        |        80 | warning  | t         | 2026-01-02 09:34:59.739664+00
 affd57ca-d3ef-411a-b84d-d400f280812a | memory.usage_percent | default | gt        |        85 | warning  | t         | 2026-01-02 09:35:01.31659+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name; (exit_code=0)

>>> R√©sultat du sc√©nario '0 - Configuration initiale (SETUP)': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 1 - Onboarding CPU
################################################################################

################################################################################
INGEST [cpu-onboarding-1] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 42
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:cpu-onboarding-1"
}
[CHECK OK]   Ingestion 'cpu-onboarding-1'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser l'ingestion √™tre trait√©e
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-02 09:35:02+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 09:34:26+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
 id | threshold_id | machine_id | metric_instance_id | status | severity | current_value | triggered_at | resolved_at | created_at 
----+--------------+------------+--------------------+--------+----------+---------------+--------------+-------------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
 id | client_id | incident_id | alert_id | provider | recipient | status | message | sent_at | created_at 
----+-----------+-------------+----------+----------+-----------+--------+---------+---------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '1 - Onboarding CPU': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 2 - NO-DATA machine DOWN
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: laisser NO-DATA se d√©clencher (machine DOWN)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-02 09:35:02+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 09:34:26+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-02 09:40:34.908087+00 | 
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                           message                                            |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                 |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                 |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                       |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                       |                               | 
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '2 - NO-DATA machine DOWN': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 3 - Restauration compl√®te machine
################################################################################

################################################################################
INGEST [cpu-restore-full] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:cpu-restore-full"
}
[CHECK OK]   Ingestion 'cpu-restore-full'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser freshness/evaluate traiter la restauration
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 30.0       | 2026-01-02 09:41:28+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 09:34:26+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 89853c8c-d481-4798-80e9-439e49706e28 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-02 09:41:34.929376+00 | 
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:40:34.908087+00 | 2026-01-02 09:41:28.999473+00
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                           message                                            |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                       |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                       |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev              +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                            |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev              +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                            |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                 |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                 |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                       |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                       |                               | 
(8 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '3 - Restauration compl√®te machine': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 4 - Ajout memory.usage_percent
################################################################################

################################################################################
INGEST [cpu-mem-onboarding] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 35
    },
    {
      "name": "memory.usage_percent",
      "value": 40
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:cpu-mem-onboarding"
}
[CHECK OK]   Ingestion 'cpu-mem-onboarding'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de l'ingestion CPU+MEM
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-02 09:42:31+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 09:42:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 89853c8c-d481-4798-80e9-439e49706e28 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:41:34.929376+00 | 2026-01-02 09:42:34.913133+00
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:40:34.908087+00 | 2026-01-02 09:41:28.999473+00
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
(10 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '4 - Ajout memory.usage_percent': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 5 - NO-DATA global puis restauration partielle
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: NO-DATA global (CPU + MEM)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-02 09:42:31+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 09:42:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 1ae292fd-46ef-431f-8695-30b5e202eea8 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-02 09:47:34.982157+00 | 
 89853c8c-d481-4798-80e9-439e49706e28 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:41:34.929376+00 | 2026-01-02 09:42:34.913133+00
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:40:34.908087+00 | 2026-01-02 09:41:28.999473+00
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 30978794-88c8-4174-a00b-f830a6b286cb | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.355107+00 | 2026-01-02 09:47:36.361497+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 c5c19db5-fa57-4969-adb3-b5732a2cff43 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.167416+00 | 2026-01-02 09:47:36.20721+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
(12 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

################################################################################
INGEST [cpu-only-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:cpu-only-restore"
}
[CHECK OK]   Ingestion 'cpu-only-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration partielle
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 25.0       | 2026-01-02 09:48:58+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 09:42:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 c8a10889-120c-464d-867e-0ee3bb6eca63 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-02 09:49:34.931378+00 | 
 1ae292fd-46ef-431f-8695-30b5e202eea8 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:47:34.982157+00 | 2026-01-02 09:48:58.191108+00
 89853c8c-d481-4798-80e9-439e49706e28 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:41:34.929376+00 | 2026-01-02 09:42:34.913133+00
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:40:34.908087+00 | 2026-01-02 09:41:28.999473+00
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 8da9426c-20c3-41b1-b925-48749d72ed8a | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.464606+00 | 2026-01-02 09:49:35.465703+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 bc8a79ee-58a2-4a1f-9d82-2398c5486fac | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.450635+00 | 2026-01-02 09:49:35.452472+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 5488c94b-e573-4041-bb97-e26500df629e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.782914+00 | 2026-01-02 09:48:58.784292+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 9e230150-e697-4667-b515-8c75809bd40b | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.746729+00 | 2026-01-02 09:48:58.747646+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 30978794-88c8-4174-a00b-f830a6b286cb | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.355107+00 | 2026-01-02 09:47:36.361497+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 c5c19db5-fa57-4969-adb3-b5732a2cff43 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.167416+00 | 2026-01-02 09:47:36.20721+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
(16 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '5 - NO-DATA global puis restauration partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 6 - Restauration compl√®te apr√®s partielle
################################################################################

################################################################################
INGEST [cpu-mem-full-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 27
    },
    {
      "name": "memory.usage_percent",
      "value": 35
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:cpu-mem-full-restore"
}
[CHECK OK]   Ingestion 'cpu-mem-full-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration compl√®te
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 27.0       | 2026-01-02 09:50:01+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 35.0       | 2026-01-02 09:50:01+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 c8a10889-120c-464d-867e-0ee3bb6eca63 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:49:34.931378+00 | 2026-01-02 09:50:35.04399+00
 1ae292fd-46ef-431f-8695-30b5e202eea8 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:47:34.982157+00 | 2026-01-02 09:48:58.191108+00
 89853c8c-d481-4798-80e9-439e49706e28 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:41:34.929376+00 | 2026-01-02 09:42:34.913133+00
 15b82f1a-dd01-4eda-ab98-ec6daea72314 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 09:40:34.908087+00 | 2026-01-02 09:41:28.999473+00
 23209503-ca35-4fe2-9130-0abdb7b48a3e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 09:39:34.949726+00 | 2026-01-02 09:40:34.903111+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 0ac19281-d952-4633-a036-b666c419027d | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.683146+00 | 2026-01-02 09:50:35.686049+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 6b33b86b-4eab-4293-ad37-b6f91ed7fd5e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.659605+00 | 2026-01-02 09:50:35.660132+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 8da9426c-20c3-41b1-b925-48749d72ed8a | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.464606+00 | 2026-01-02 09:49:35.465703+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 bc8a79ee-58a2-4a1f-9d82-2398c5486fac | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |          | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.450635+00 | 2026-01-02 09:49:35.452472+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 5488c94b-e573-4041-bb97-e26500df629e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.782914+00 | 2026-01-02 09:48:58.784292+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 9e230150-e697-4667-b515-8c75809bd40b | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.746729+00 | 2026-01-02 09:48:58.747646+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 30978794-88c8-4174-a00b-f830a6b286cb | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.355107+00 | 2026-01-02 09:47:36.361497+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 c5c19db5-fa57-4969-adb3-b5732a2cff43 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.167416+00 | 2026-01-02 09:47:36.20721+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 4439186f-a044-4521-bb99-4a26539aab76 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.747765+00 | 2026-01-02 09:39:35.752419+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
 297c88dd-a7e5-47db-b677-4f291b0f5fd9 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 23209503-ca35-4fe2-9130-0abdb7b48a3e |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:39:35.563766+00 | 2026-01-02 09:39:35.573131+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 308s (seuil 300s)                                                                                                                                                             |                               | 
(18 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '6 - Restauration compl√®te apr√®s partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 7 - Seuil CPU d√©pass√©
################################################################################

################################################################################
INGEST [threshold-cpu-high] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:threshold-cpu-high"
}
[CHECK OK]   Ingestion 'threshold-cpu-high'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: √©valuation des seuils CPU high
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 95.0       | 2026-01-02 09:51:05+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 09:51:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          | status | severity | current_value |         triggered_at          | resolved_at |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+--------+----------+---------------+-------------------------------+-------------+-------------------------------
 d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | 850aa358-8949-41b4-aa13-fb6ac4e8a486 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | 48117524-28ca-40ce-b1d8-68318e1ebf10 | FIRING | warning  | 95.0          | 2026-01-02 09:51:05.327814+00 |             | 2026-01-02 09:51:05.329051+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 3a0e3faf-8b8b-4ed2-8adb-139941ee93bf | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 887dc184-a0a0-4dff-956e-b8bdace527b0 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 09:51:35.559659+00 | 2026-01-02 09:51:35.580226+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:51:05+00:00                                                                                                                                    |                               | 
 e6d7920c-c9a8-4c98-9a34-d1e8f8d30a34 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 887dc184-a0a0-4dff-956e-b8bdace527b0 |                                      | slack    | #notif-webhook               | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 09:51:35.483655+00 | 2026-01-02 09:51:35.484942+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:51:05+00:00                                                                                                                                    |                               | 
 7c2573ff-d867-43f6-9aef-7ebd6a19d967 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d |                                      | d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 09:51:05.915655+00 | 2026-01-02 09:51:05.91785+00
 ec52fd5e-12e4-42fe-a6d9-05896089459c | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d |                                      | d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | slack    | #notif-webhook               | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 09:51:05.896908+00 | 2026-01-02 09:51:05.897348+00
 0ac19281-d952-4633-a036-b666c419027d | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.683146+00 | 2026-01-02 09:50:35.686049+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 6b33b86b-4eab-4293-ad37-b6f91ed7fd5e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.659605+00 | 2026-01-02 09:50:35.660132+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 8da9426c-20c3-41b1-b925-48749d72ed8a | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.464606+00 | 2026-01-02 09:49:35.465703+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 bc8a79ee-58a2-4a1f-9d82-2398c5486fac | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.450635+00 | 2026-01-02 09:49:35.452472+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 5488c94b-e573-4041-bb97-e26500df629e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.782914+00 | 2026-01-02 09:48:58.784292+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 9e230150-e697-4667-b515-8c75809bd40b | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.746729+00 | 2026-01-02 09:48:58.747646+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 30978794-88c8-4174-a00b-f830a6b286cb | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.355107+00 | 2026-01-02 09:47:36.361497+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 c5c19db5-fa57-4969-adb3-b5732a2cff43 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.167416+00 | 2026-01-02 09:47:36.20721+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 669b4b51-c8e0-4e2d-9e9d-250a94c85232 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.595032+00 | 2026-01-02 09:40:35.600618+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
 808bfb64-50a2-4928-8c86-cae057c20acd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:40:35.486017+00 | 2026-01-02 09:40:35.487179+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 368s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK OK]   Incident threshold OPEN (cpu.usage_percent): count=1 (min_expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte FIRING (cpu.usage_percent): count=1 (min_expected=1)

>>> R√©sultat du sc√©nario '7 - Seuil CPU d√©pass√©': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 8 - Seuils revenus √† la normale
################################################################################

################################################################################
INGEST [threshold-all-ok] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_103426_596a69b4:threshold-all-ok"
}
[CHECK OK]   Ingestion 'threshold-all-ok'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: r√©solution des alertes de seuil
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 48117524-28ca-40ce-b1d8-68318e1ebf10 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-02 09:52:09+00
 5950b70d-0e3e-451c-9fa1-ba6d20dad49a | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | memory.usage_percent | t                   | t               | f         | 25.0       | 2026-01-02 09:52:09+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          |  status  | severity | current_value |         triggered_at          |          resolved_at          |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+---------------+-------------------------------+-------------------------------+-------------------------------
 d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | 850aa358-8949-41b4-aa13-fb6ac4e8a486 | 0335b81f-582e-44cc-be2e-77ef4b9b7b48 | 48117524-28ca-40ce-b1d8-68318e1ebf10 | RESOLVED | warning  | 95.0          | 2026-01-02 09:51:05.327814+00 | 2026-01-02 09:52:09.418865+00 | 2026-01-02 09:51:05.329051+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 186b6747-c1ff-44e4-804b-7aaf377a87dc | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 2aad56dd-2f67-4801-af2c-cc88e327acdd |                                      | email    | frederic.gilgarcia@gmail.com | success | (#007) ‚úÖ Threshold back to normal: Machine: debian-dev                                                                                                                           +| 2026-01-02 09:52:09.993959+00 | 2026-01-02 09:52:10.00372+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 b4b31059-99c9-4940-b89d-0617b375ecf0 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 2aad56dd-2f67-4801-af2c-cc88e327acdd |                                      | slack    | #notif-webhook               | success | (#007) ‚úÖ Threshold back to normal: Machine: debian-dev                                                                                                                           +| 2026-01-02 09:52:09.92792+00  | 2026-01-02 09:52:09.928759+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 3a0e3faf-8b8b-4ed2-8adb-139941ee93bf | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 887dc184-a0a0-4dff-956e-b8bdace527b0 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 09:51:35.559659+00 | 2026-01-02 09:51:35.580226+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:51:05+00:00                                                                                                                                    |                               | 
 e6d7920c-c9a8-4c98-9a34-d1e8f8d30a34 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 887dc184-a0a0-4dff-956e-b8bdace527b0 |                                      | slack    | #notif-webhook               | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 09:51:35.483655+00 | 2026-01-02 09:51:35.484942+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:51:05+00:00                                                                                                                                    |                               | 
 7c2573ff-d867-43f6-9aef-7ebd6a19d967 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d |                                      | d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 09:51:05.915655+00 | 2026-01-02 09:51:05.91785+00
 ec52fd5e-12e4-42fe-a6d9-05896089459c | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d |                                      | d9eb2ddd-77fc-4846-a512-7ab4d86116c6 | slack    | #notif-webhook               | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 09:51:05.896908+00 | 2026-01-02 09:51:05.897348+00
 0ac19281-d952-4633-a036-b666c419027d | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.683146+00 | 2026-01-02 09:50:35.686049+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 6b33b86b-4eab-4293-ad37-b6f91ed7fd5e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:50:35.659605+00 | 2026-01-02 09:50:35.660132+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:50:01+00:00                                                                                                                                    |                               | 
 8da9426c-20c3-41b1-b925-48749d72ed8a | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | email    | frederic.gilgarcia@gmail.com | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.464606+00 | 2026-01-02 09:49:35.465703+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 bc8a79ee-58a2-4a1f-9d82-2398c5486fac | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | c8a10889-120c-464d-867e-0ee3bb6eca63 |                                      | slack    | #notif-webhook               | success | üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                             +| 2026-01-02 09:49:35.450635+00 | 2026-01-02 09:49:35.452472+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 423s (seuil 300s)                                                                                                                                                             |                               | 
 5488c94b-e573-4041-bb97-e26500df629e | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.782914+00 | 2026-01-02 09:48:58.784292+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 9e230150-e697-4667-b515-8c75809bd40b | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:48:58.746729+00 | 2026-01-02 09:48:58.747646+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 30978794-88c8-4174-a00b-f830a6b286cb | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.355107+00 | 2026-01-02 09:47:36.361497+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 c5c19db5-fa57-4969-adb3-b5732a2cff43 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 1ae292fd-46ef-431f-8695-30b5e202eea8 |                                      | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 09:47:36.167416+00 | 2026-01-02 09:47:36.20721+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 303s (seuil 300s).                                                                                                                                       |                               | 
 8094d2c9-70fd-480b-97d9-a636167959ae | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.525913+00 | 2026-01-02 09:42:35.540066+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 a9bbfca0-c436-4e0b-8217-b35f30c8a915 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 09:42:35.475062+00 | 2026-01-02 09:42:35.476302+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:42:31+00:00                                                                                                                                    |                               | 
 963d1754-7121-4abb-b11c-90495607a8dd | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.564175+00 | 2026-01-02 09:41:35.56598+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 dd8f750b-9fe7-40ce-93cc-4eb95384efce | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 89853c8c-d481-4798-80e9-439e49706e28 |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 09:41:35.471481+00 | 2026-01-02 09:41:35.477424+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T09:34:26+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 428s (seuil 300s)                                                                                                                                                             |                               | 
 b0fc2678-c8c3-4aaa-abee-013156004867 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.561231+00 | 2026-01-02 09:41:29.573477+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 299357c1-57c4-4dab-8529-40903a06ed49 | d79a844b-f6ce-4ee3-b0a2-81fa880b3f1d | 15b82f1a-dd01-4eda-ab98-ec6daea72314 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 09:41:29.492716+00 | 2026-01-02 09:41:29.493784+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK OK]   Incident threshold NOT OPEN (cpu.usage_percent): count=0

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte NOT FIRING (cpu.usage_percent): count=0

>>> R√©sultat du sc√©nario '8 - Seuils revenus √† la normale': SUCCESS ‚úÖ


################################################################################
#  R√âSUM√â GLOBAL DES SC√âNARIOS
################################################################################

Sc√©narios ex√©cut√©s : 9
  - SUCCESS : 9
  - FAIL    : 0

  - 0 - Configuration initiale (SETUP): SUCCESS ‚úÖ
  - 1 - Onboarding CPU: SUCCESS ‚úÖ
  - 2 - NO-DATA machine DOWN: SUCCESS ‚úÖ
  - 3 - Restauration compl√®te machine: SUCCESS ‚úÖ
  - 4 - Ajout memory.usage_percent: SUCCESS ‚úÖ
  - 5 - NO-DATA global puis restauration partielle: SUCCESS ‚úÖ
  - 6 - Restauration compl√®te apr√®s partielle: SUCCESS ‚úÖ
  - 7 - Seuil CPU d√©pass√©: SUCCESS ‚úÖ
  - 8 - Seuils revenus √† la normale: SUCCESS ‚úÖ

--------------------------------------------------------------------------------
#  STATISTIQUES DES CHECKS (commandes HTTP/SQL)
--------------------------------------------------------------------------------
Checks totaux   : 64
Checks OK       : 64
Checks en √©chec : 0
Taux de succ√®s  : 100.00 %

#  FIN DU SC√âNARIO COMPLET
################################################################################

