
################################################################################
#  SC√âNARIO MATRICE ALERTES / NO-DATA (cpu.usage_percent + memory.usage_percent)
#  Machine : debian-dev
#  Client  : Dev
#  Fingerprint : f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1
################################################################################

################################################################################
#  SC√âNARIO : 0 - Configuration initiale (SETUP)
################################################################################

üîß Configuration initiale de la machine et des seuils...

################################################################################
INGEST [setup-initial] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:setup-initial"
}
[CHECK OK]   Ingestion 'setup-initial'

--------------------------------------------------------------------------------
‚è±  Attente 30s pour: cr√©ation des metric_instances
--------------------------------------------------------------------------------
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üîß ACTIVATION DE L'ALERTING SUR LES M√âTRIQUES

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') );
================================================================================
UPDATE 2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ); (exit_code=0)

üîß CR√âATION DU SEUIL POUR cpu.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent';
================================================================================
4ab1c6d2-9655-4689-8598-61c8dc5e8b7b
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '4ab1c6d2-9655-4689-8598-61c8dc5e8b7b' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '4ab1c6d2-9655-4689-8598-61c8dc5e8b7b' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour cpu.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '4ab1c6d2-9655-4689-8598-61c8dc5e8b7b',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '4ab1c6d2-9655-4689-8598-61c8dc5e8b7b',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT cpu.usage_percent

üîß CR√âATION DU SEUIL POUR memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent';
================================================================================
d1652837-b6d9-4443-98c1-83181586120a
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = 'd1652837-b6d9-4443-98c1-83181586120a' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = 'd1652837-b6d9-4443-98c1-83181586120a' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour memory.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     'd1652837-b6d9-4443-98c1-83181586120a',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     'd1652837-b6d9-4443-98c1-83181586120a',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT memory.usage_percent

üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-02 14:01:05+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 14:01:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

‚öôÔ∏è  SEUILS CONFIGUR√âS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name;
================================================================================
                  id                  |    name_effective    |  name   | condition | value_num | severity | is_active |          created_at           
--------------------------------------+----------------------+---------+-----------+-----------+----------+-----------+-------------------------------
 77a12177-e14e-4d9a-b7c5-156abddf3d88 | cpu.usage_percent    | default | gt        |        80 | warning  | t         | 2026-01-02 14:01:39.468977+00
 c2f258f5-9c6d-47f9-9b39-8bcce9fc676c | memory.usage_percent | default | gt        |        85 | warning  | t         | 2026-01-02 14:01:41.615444+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name; (exit_code=0)

>>> R√©sultat du sc√©nario '0 - Configuration initiale (SETUP)': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 1 - Onboarding CPU
################################################################################

################################################################################
INGEST [cpu-onboarding-1] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 42
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:cpu-onboarding-1"
}
[CHECK OK]   Ingestion 'cpu-onboarding-1'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser l'ingestion √™tre trait√©e
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-02 14:01:42+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 14:01:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
 id | threshold_id | machine_id | metric_instance_id | status | severity | current_value | triggered_at | resolved_at | created_at 
----+--------------+------------+--------------------+--------+----------+---------------+--------------+-------------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
 id | client_id | incident_id | alert_id | provider | recipient | status | message | sent_at | created_at 
----+-----------+-------------+----------+----------+-----------+--------+---------+---------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '1 - Onboarding CPU': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 2 - NO-DATA machine DOWN
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: laisser NO-DATA se d√©clencher (machine DOWN)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-02 14:01:42+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 14:01:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-02 14:07:28.60554+00  | 
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                           message                                            |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                 |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                 |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                       |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                       |                               | 
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '2 - NO-DATA machine DOWN': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 3 - Restauration compl√®te machine
################################################################################

################################################################################
INGEST [cpu-restore-full] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:cpu-restore-full"
}
[CHECK OK]   Ingestion 'cpu-restore-full'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser freshness/evaluate traiter la restauration
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 30.0       | 2026-01-02 14:08:09+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 14:01:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4bea0a69-4b36-458b-ba6e-b370174bbeac | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-02 14:08:28.649422+00 | 
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:07:28.60554+00  | 2026-01-02 14:08:09.840738+00
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                           message                                            |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                       |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                       |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev              +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                            |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev              +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                            |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                 |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                    +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                 +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                 |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                       |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev+| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                              +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                             +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                       |                               | 
(8 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '3 - Restauration compl√®te machine': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 4 - Ajout memory.usage_percent
################################################################################

################################################################################
INGEST [cpu-mem-onboarding] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 35
    },
    {
      "name": "memory.usage_percent",
      "value": 40
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:cpu-mem-onboarding"
}
[CHECK OK]   Ingestion 'cpu-mem-onboarding'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de l'ingestion CPU+MEM
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-02 14:09:13+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 14:09:13+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4bea0a69-4b36-458b-ba6e-b370174bbeac | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:08:28.649422+00 | 2026-01-02 14:09:28.603823+00
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:07:28.60554+00  | 2026-01-02 14:08:09.840738+00
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
(10 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '4 - Ajout memory.usage_percent': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 5 - NO-DATA global puis restauration partielle
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: NO-DATA global (CPU + MEM)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-02 14:09:13+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 14:09:13+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 43318d6a-1811-4b25-a574-1102f474fb91 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-02 14:14:28.671339+00 | 
 4bea0a69-4b36-458b-ba6e-b370174bbeac | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:08:28.649422+00 | 2026-01-02 14:09:28.603823+00
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:07:28.60554+00  | 2026-01-02 14:08:09.840738+00
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 939db4b7-6aad-4df1-ab1d-350bcb1cf392 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:14:29.268855+00 | 2026-01-02 14:14:29.274614+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 9f0540c4-4a61-4774-b37c-7943101344e6 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | slack    | #notif-webhook2              | failed  | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +|                               | 2026-01-02 14:14:29.196532+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
(12 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

################################################################################
INGEST [cpu-only-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:cpu-only-restore"
}
[CHECK OK]   Ingestion 'cpu-only-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration partielle
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 25.0       | 2026-01-02 14:15:37+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-02 14:09:13+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-02 14:16:28.692325+00 | 
 43318d6a-1811-4b25-a574-1102f474fb91 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:14:28.671339+00 | 2026-01-02 14:15:37.751273+00
 4bea0a69-4b36-458b-ba6e-b370174bbeac | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:08:28.649422+00 | 2026-01-02 14:09:28.603823+00
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:07:28.60554+00  | 2026-01-02 14:08:09.840738+00
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 bfc81fb5-bc23-4613-b64d-d8cf8c433780 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:16:29.508546+00 | 2026-01-02 14:16:29.517098+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 a77a8237-0c6c-4555-9779-eec8bf23989b | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | slack    | #notif-webhook2              | failed  | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +|                               | 2026-01-02 14:16:29.451757+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 62a80eaf-df1a-42a4-ac20-9d80789d06f8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:15:38.395094+00 | 2026-01-02 14:15:38.402104+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 b10d33ca-4736-45cd-a235-0b9030e8bba1 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | slack    | #notif-webhook2              | failed  | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +|                               | 2026-01-02 14:15:38.340279+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 939db4b7-6aad-4df1-ab1d-350bcb1cf392 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:14:29.268855+00 | 2026-01-02 14:14:29.274614+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 9f0540c4-4a61-4774-b37c-7943101344e6 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | slack    | #notif-webhook2              | failed  | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +|                               | 2026-01-02 14:14:29.196532+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
(16 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '5 - NO-DATA global puis restauration partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 6 - Restauration compl√®te apr√®s partielle
################################################################################

################################################################################
INGEST [cpu-mem-full-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 27
    },
    {
      "name": "memory.usage_percent",
      "value": 35
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:cpu-mem-full-restore"
}
[CHECK OK]   Ingestion 'cpu-mem-full-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration compl√®te
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 27.0       | 2026-01-02 14:16:40+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 35.0       | 2026-01-02 14:16:40+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:16:28.692325+00 | 2026-01-02 14:17:28.637876+00
 43318d6a-1811-4b25-a574-1102f474fb91 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:14:28.671339+00 | 2026-01-02 14:15:37.751273+00
 4bea0a69-4b36-458b-ba6e-b370174bbeac | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:08:28.649422+00 | 2026-01-02 14:09:28.603823+00
 05069c9b-4aa7-474d-8af7-87087051cff5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-02 14:07:28.60554+00  | 2026-01-02 14:08:09.840738+00
 16ec622c-32cf-46e3-b026-c101b1c83141 | 569e0e62-11df-49f3-afdd-132b109204f8 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | (#001) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-02 14:06:28.654565+00 | 2026-01-02 14:07:28.600108+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 074896db-2a92-4134-ad61-fe89ca4f70a8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:17:29.338269+00 | 2026-01-02 14:17:29.340108+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 1af03c74-bbb6-4448-a0a7-6077d1676e88 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | slack    | #notif-webhook2              | failed  | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+|                               | 2026-01-02 14:17:29.272524+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 bfc81fb5-bc23-4613-b64d-d8cf8c433780 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:16:29.508546+00 | 2026-01-02 14:16:29.517098+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 a77a8237-0c6c-4555-9779-eec8bf23989b | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |          | slack    | #notif-webhook2              | failed  | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +|                               | 2026-01-02 14:16:29.451757+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 62a80eaf-df1a-42a4-ac20-9d80789d06f8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:15:38.395094+00 | 2026-01-02 14:15:38.402104+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 b10d33ca-4736-45cd-a235-0b9030e8bba1 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | slack    | #notif-webhook2              | failed  | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +|                               | 2026-01-02 14:15:38.340279+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 939db4b7-6aad-4df1-ab1d-350bcb1cf392 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:14:29.268855+00 | 2026-01-02 14:14:29.274614+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 9f0540c4-4a61-4774-b37c-7943101344e6 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |          | slack    | #notif-webhook2              | failed  | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +|                               | 2026-01-02 14:14:29.196532+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 e966bc63-4818-47a6-9064-43dffcf3422a | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.364132+00 | 2026-01-02 14:06:29.36782+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
 59fda7c0-1d58-4055-914a-de93749ce493 | 569e0e62-11df-49f3-afdd-132b109204f8 | 16ec622c-32cf-46e3-b026-c101b1c83141 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:06:29.277775+00 | 2026-01-02 14:06:29.284804+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 323s (seuil 300s)                                                                                                                                                             |                               | 
(18 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '6 - Restauration compl√®te apr√®s partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 7 - Seuil CPU d√©pass√©
################################################################################

################################################################################
INGEST [threshold-cpu-high] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:threshold-cpu-high"
}
[CHECK OK]   Ingestion 'threshold-cpu-high'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: √©valuation des seuils CPU high
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 95.0       | 2026-01-02 14:17:42+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-02 14:17:42+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          | status | severity | current_value |         triggered_at          | resolved_at |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+--------+----------+---------------+-------------------------------+-------------+-------------------------------
 d7aa4a58-e955-4d7b-ae40-82fab62fc727 | 77a12177-e14e-4d9a-b7c5-156abddf3d88 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | FIRING | warning  | 95.0          | 2026-01-02 14:17:42.863066+00 |             | 2026-01-02 14:17:42.863994+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 58651703-b989-43e1-b551-ae14100fa2d2 | 569e0e62-11df-49f3-afdd-132b109204f8 | e36d8649-dd12-4c7e-8f9c-87b6b82a3745 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 14:18:29.383022+00 | 2026-01-02 14:18:29.385294+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:17:42+00:00                                                                                                                                    |                               | 
 dd79d46f-1f5c-49f4-b0e2-9009a6083a11 | 569e0e62-11df-49f3-afdd-132b109204f8 | e36d8649-dd12-4c7e-8f9c-87b6b82a3745 |                                      | slack    | #notif-webhook2              | failed  | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +|                               | 2026-01-02 14:18:29.295495+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:17:42+00:00                                                                                                                                    |                               | 
 7283f092-ce37-494a-8cb6-45b9494a1284 | 569e0e62-11df-49f3-afdd-132b109204f8 |                                      | d7aa4a58-e955-4d7b-ae40-82fab62fc727 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 14:17:43.398703+00 | 2026-01-02 14:17:43.404577+00
 959b9c63-ec67-4801-9588-2bea4cca9c39 | 569e0e62-11df-49f3-afdd-132b109204f8 |                                      | d7aa4a58-e955-4d7b-ae40-82fab62fc727 | slack    | #notif-webhook2              | failed  | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  |                               | 2026-01-02 14:17:43.350364+00
 074896db-2a92-4134-ad61-fe89ca4f70a8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:17:29.338269+00 | 2026-01-02 14:17:29.340108+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 1af03c74-bbb6-4448-a0a7-6077d1676e88 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | slack    | #notif-webhook2              | failed  | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+|                               | 2026-01-02 14:17:29.272524+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 bfc81fb5-bc23-4613-b64d-d8cf8c433780 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:16:29.508546+00 | 2026-01-02 14:16:29.517098+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 a77a8237-0c6c-4555-9779-eec8bf23989b | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | slack    | #notif-webhook2              | failed  | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +|                               | 2026-01-02 14:16:29.451757+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 62a80eaf-df1a-42a4-ac20-9d80789d06f8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:15:38.395094+00 | 2026-01-02 14:15:38.402104+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 b10d33ca-4736-45cd-a235-0b9030e8bba1 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | slack    | #notif-webhook2              | failed  | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +|                               | 2026-01-02 14:15:38.340279+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 939db4b7-6aad-4df1-ab1d-350bcb1cf392 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:14:29.268855+00 | 2026-01-02 14:14:29.274614+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 9f0540c4-4a61-4774-b37c-7943101344e6 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | slack    | #notif-webhook2              | failed  | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +|                               | 2026-01-02 14:14:29.196532+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 a52f7cbd-b328-47bc-a1f8-31ee6cadc2f0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.155962+00 | 2026-01-02 14:07:29.159643+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
 1b365c63-6ba9-4a92-b124-fdfe341d8826 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:07:29.101169+00 | 2026-01-02 14:07:29.105282+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 383s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK OK]   Incident threshold OPEN (cpu.usage_percent): count=1 (min_expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte FIRING (cpu.usage_percent): count=1 (min_expected=1)

>>> R√©sultat du sc√©nario '7 - Seuil CPU d√©pass√©': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 8 - Seuils revenus √† la normale
################################################################################

################################################################################
INGEST [threshold-all-ok] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260102_150105_65e2c744:threshold-all-ok"
}
[CHECK OK]   Ingestion 'threshold-all-ok'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: r√©solution des alertes de seuil
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-02 14:18:47+00
 d1652837-b6d9-4443-98c1-83181586120a | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | memory.usage_percent | t                   | t               | f         | 25.0       | 2026-01-02 14:18:47+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          |  status  | severity | current_value |         triggered_at          |          resolved_at          |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+---------------+-------------------------------+-------------------------------+-------------------------------
 d7aa4a58-e955-4d7b-ae40-82fab62fc727 | 77a12177-e14e-4d9a-b7c5-156abddf3d88 | 8d2a5b39-7488-4133-9d9c-6fd7009f559e | 4ab1c6d2-9655-4689-8598-61c8dc5e8b7b | RESOLVED | warning  | 95.0          | 2026-01-02 14:17:42.863066+00 | 2026-01-02 14:18:47.223068+00 | 2026-01-02 14:17:42.863994+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 4e9d7396-88a7-4952-a6e6-46316736b2f8 | 569e0e62-11df-49f3-afdd-132b109204f8 | a56dc9d2-89f5-477d-aaac-496f9f980c56 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#007) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-02 14:18:47.734448+00 | 2026-01-02 14:18:47.738654+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 52343c3a-e7d5-459e-b0c0-5c5174b642ea | 569e0e62-11df-49f3-afdd-132b109204f8 | a56dc9d2-89f5-477d-aaac-496f9f980c56 |                                      | slack    | #notif-webhook2              | failed  | (#007) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +|                               | 2026-01-02 14:18:47.71313+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 58651703-b989-43e1-b551-ae14100fa2d2 | 569e0e62-11df-49f3-afdd-132b109204f8 | e36d8649-dd12-4c7e-8f9c-87b6b82a3745 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +| 2026-01-02 14:18:29.383022+00 | 2026-01-02 14:18:29.385294+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:17:42+00:00                                                                                                                                    |                               | 
 dd79d46f-1f5c-49f4-b0e2-9009a6083a11 | 569e0e62-11df-49f3-afdd-132b109204f8 | e36d8649-dd12-4c7e-8f9c-87b6b82a3745 |                                      | slack    | #notif-webhook2              | failed  | (#006) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'cpu.usage_percent' restaur√©e: La m√©trique 'cpu.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.      +|                               | 2026-01-02 14:18:29.295495+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:17:42+00:00                                                                                                                                    |                               | 
 7283f092-ce37-494a-8cb6-45b9494a1284 | 569e0e62-11df-49f3-afdd-132b109204f8 |                                      | d7aa4a58-e955-4d7b-ae40-82fab62fc727 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  | 2026-01-02 14:17:43.398703+00 | 2026-01-02 14:17:43.404577+00
 959b9c63-ec67-4801-9588-2bea4cca9c39 | 569e0e62-11df-49f3-afdd-132b109204f8 |                                      | d7aa4a58-e955-4d7b-ae40-82fab62fc727 | slack    | #notif-webhook2              | failed  | üö® Alerte WARNING: cpu.usage_percent gt threshold (threshold=80.0) - Valeur: 95.0                                                                                                  |                               | 2026-01-02 14:17:43.350364+00
 074896db-2a92-4134-ad61-fe89ca4f70a8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:17:29.338269+00 | 2026-01-02 14:17:29.340108+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 1af03c74-bbb6-4448-a0a7-6077d1676e88 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | slack    | #notif-webhook2              | failed  | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+|                               | 2026-01-02 14:17:29.272524+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:16:40+00:00                                                                                                                                    |                               | 
 bfc81fb5-bc23-4613-b64d-d8cf8c433780 | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:16:29.508546+00 | 2026-01-02 14:16:29.517098+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 a77a8237-0c6c-4555-9779-eec8bf23989b | 569e0e62-11df-49f3-afdd-132b109204f8 | 39c93c9b-9b30-443c-bfe0-c0f5b588ff6d |                                      | slack    | #notif-webhook2              | failed  | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +|                               | 2026-01-02 14:16:29.451757+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 435s (seuil 300s)                                                                                                                                                             |                               | 
 62a80eaf-df1a-42a4-ac20-9d80789d06f8 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:15:38.395094+00 | 2026-01-02 14:15:38.402104+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 b10d33ca-4736-45cd-a235-0b9030e8bba1 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | slack    | #notif-webhook2              | failed  | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +|                               | 2026-01-02 14:15:38.340279+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 939db4b7-6aad-4df1-ab1d-350bcb1cf392 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-02 14:14:29.268855+00 | 2026-01-02 14:14:29.274614+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 9f0540c4-4a61-4774-b37c-7943101344e6 | 569e0e62-11df-49f3-afdd-132b109204f8 | 43318d6a-1811-4b25-a574-1102f474fb91 |                                      | slack    | #notif-webhook2              | failed  | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +|                               | 2026-01-02 14:14:29.196532+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 315s (seuil 300s).                                                                                                                                       |                               | 
 a2b9e5ed-e120-400a-ad35-0b9937d10174 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.166357+00 | 2026-01-02 14:09:29.177389+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 3ce0600e-38b9-452d-87d9-ad4d92858c3e | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-02 14:09:29.104143+00 | 2026-01-02 14:09:29.104913+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:09:13+00:00                                                                                                                                    |                               | 
 dcbfaf46-08d7-4338-9ac3-becc0ab267cf | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.589155+00 | 2026-01-02 14:08:29.590219+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 85ba6a6c-f5fb-4c7f-9f71-d6ba6f75e7d0 | 569e0e62-11df-49f3-afdd-132b109204f8 | 4bea0a69-4b36-458b-ba6e-b370174bbeac |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-02 14:08:29.463217+00 | 2026-01-02 14:08:29.468882+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-02T14:01:05+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 443s (seuil 300s)                                                                                                                                                             |                               | 
 04b66f94-86c6-4ffd-bef3-f3b5023d1dc5 | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.365105+00 | 2026-01-02 14:08:10.36775+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 42f51714-115d-4702-8c46-62577a8d0b0e | 569e0e62-11df-49f3-afdd-132b109204f8 | 05069c9b-4aa7-474d-8af7-87087051cff5 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-02 14:08:10.339815+00 | 2026-01-02 14:08:10.34057+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK OK]   Incident threshold NOT OPEN (cpu.usage_percent): count=0

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte NOT FIRING (cpu.usage_percent): count=0

>>> R√©sultat du sc√©nario '8 - Seuils revenus √† la normale': SUCCESS ‚úÖ


################################################################################
#  R√âSUM√â GLOBAL DES SC√âNARIOS
################################################################################

Sc√©narios ex√©cut√©s : 9
  - SUCCESS : 9
  - FAIL    : 0

  - 0 - Configuration initiale (SETUP): SUCCESS ‚úÖ
  - 1 - Onboarding CPU: SUCCESS ‚úÖ
  - 2 - NO-DATA machine DOWN: SUCCESS ‚úÖ
  - 3 - Restauration compl√®te machine: SUCCESS ‚úÖ
  - 4 - Ajout memory.usage_percent: SUCCESS ‚úÖ
  - 5 - NO-DATA global puis restauration partielle: SUCCESS ‚úÖ
  - 6 - Restauration compl√®te apr√®s partielle: SUCCESS ‚úÖ
  - 7 - Seuil CPU d√©pass√©: SUCCESS ‚úÖ
  - 8 - Seuils revenus √† la normale: SUCCESS ‚úÖ

--------------------------------------------------------------------------------
#  STATISTIQUES DES CHECKS (commandes HTTP/SQL)
--------------------------------------------------------------------------------
Checks totaux   : 64
Checks OK       : 64
Checks en √©chec : 0
Taux de succ√®s  : 100.00 %

#  FIN DU SC√âNARIO COMPLET
################################################################################

