
################################################################################
#  SCÃ‰NARIO MATRICE ALERTES / NO-DATA (cpu.usage_percent + memory.usage_percent)
#  Machine : debian-dev
#  Client  : Dev
#  Fingerprint : f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1
################################################################################

################################################################################
#  SCÃ‰NARIO : 0 - Configuration initiale (SETUP)
################################################################################

ðŸ”§ Configuration initiale de la machine et des seuils...

################################################################################
INGEST [setup-initial] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:setup-initial"
}
[CHECK OK]   Ingestion 'setup-initial'

--------------------------------------------------------------------------------
â±  Attente 30s pour: crÃ©ation des metric_instances
--------------------------------------------------------------------------------
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ”§ ACTIVATION DE L'ALERTING SUR LES MÃ‰TRIQUES

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') );
================================================================================
UPDATE 2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ); (exit_code=0)

ðŸ”§ CRÃ‰ATION DU SEUIL POUR cpu.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent';
================================================================================
8aa32ded-a495-43b8-87c0-6d0dd31c00f8
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '8aa32ded-a495-43b8-87c0-6d0dd31c00f8' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '8aa32ded-a495-43b8-87c0-6d0dd31c00f8' AND name = 'default'; (exit_code=0)
â„¹ï¸  CrÃ©ation d'un nouveau seuil DEFAULT pour cpu.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '8aa32ded-a495-43b8-87c0-6d0dd31c00f8',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '8aa32ded-a495-43b8-87c0-6d0dd31c00f8',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT cpu.usage_percent

ðŸ”§ CRÃ‰ATION DU SEUIL POUR memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent';
================================================================================
5c2ed48d-64c6-4279-8642-59604a69ef78
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '5c2ed48d-64c6-4279-8642-59604a69ef78' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '5c2ed48d-64c6-4279-8642-59604a69ef78' AND name = 'default'; (exit_code=0)
â„¹ï¸  CrÃ©ation d'un nouveau seuil DEFAULT pour memory.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '5c2ed48d-64c6-4279-8642-59604a69ef78',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '5c2ed48d-64c6-4279-8642-59604a69ef78',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET reminder_notification_seconds = 5,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET reminder_notification_seconds = 5,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 15:14:31+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 15:14:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

âš™ï¸  SEUILS CONFIGURÃ‰S

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name;
================================================================================
                  id                  |    name_effective    |  name   | condition | value_num | severity | is_active |          created_at           
--------------------------------------+----------------------+---------+-----------+-----------+----------+-----------+-------------------------------
 6721dc91-bb8e-4881-8e12-3bb49f3fce28 | cpu.usage_percent    | default | gt        |        80 | warning  | t         | 2026-01-03 15:15:04.337854+00
 c02e29e8-4775-4ea8-8a52-ac7141eb8509 | memory.usage_percent | default | gt        |        85 | warning  | t         | 2026-01-03 15:15:05.921795+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '0 - Configuration initiale (SETUP)': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 1 - Onboarding CPU
################################################################################

################################################################################
INGEST [cpu-onboarding-1] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 42
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:cpu-onboarding-1"
}
[CHECK OK]   Ingestion 'cpu-onboarding-1'

--------------------------------------------------------------------------------
â±  Attente 60s pour: laisser l'ingestion Ãªtre traitÃ©e
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 15:15:08+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 15:14:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC; (exit_code=0)

âš ï¸  Ã‰TAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
 id | threshold_id | machine_id | metric_instance_id | status | severity | current_value | triggered_at | resolved_at | created_at 
----+--------------+------------+--------------------+--------+----------+---------------+--------------+-------------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
 id | client_id | incident_id | alert_id | provider | recipient | status | message | sent_at | created_at 
----+-----------+-------------+----------+----------+-----------+--------+---------+---------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '1 - Onboarding CPU': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 2 - NO-DATA machine DOWN
################################################################################

--------------------------------------------------------------------------------
â±  Attente 320s pour: laisser NO-DATA se dÃ©clencher (machine DOWN)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 15:15:08+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 15:14:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                   title                    | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------------+----------+--------+-------------------------------+-------------
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e | critical | OPEN   | 2026-01-03 15:20:12.864189+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                   title                    | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------------+----------+--------+-------------------------------+-------------
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e | critical | OPEN   | 2026-01-03 15:20:12.864189+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                   message                                   |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+-----------------------------------------------------------------------------+-------------------------------+-------------------------------
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                |                               | 
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '2 - NO-DATA machine DOWN': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 3 - Restauration complÃ¨te machine
################################################################################

################################################################################
INGEST [cpu-restore-full] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:cpu-restore-full"
}
[CHECK OK]   Ingestion 'cpu-restore-full'

--------------------------------------------------------------------------------
â±  Attente 60s pour: laisser freshness/evaluate traiter la restauration
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 30.0       | 2026-01-03 15:21:34+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 15:14:31+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 15:22:12.899986+00 | 
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 15:22:12.899986+00 | 
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                       message                                                        |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                        +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                               |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                        +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                               |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                         |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                         |                               | 
(6 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '3 - Restauration complÃ¨te machine': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 4 - Ajout memory.usage_percent
################################################################################

################################################################################
INGEST [cpu-mem-onboarding] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 35
    },
    {
      "name": "memory.usage_percent",
      "value": 40
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:cpu-mem-onboarding"
}
[CHECK OK]   Ingestion 'cpu-mem-onboarding'

--------------------------------------------------------------------------------
â±  Attente 60s pour: traitement de l'ingestion CPU+MEM
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 15:22:36+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 15:22:36+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(8 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '4 - Ajout memory.usage_percent': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 5 - NO-DATA global puis restauration partielle
################################################################################

--------------------------------------------------------------------------------
â±  Attente 320s pour: NO-DATA global (CPU + MEM)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 15:22:36+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 15:22:36+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | OPEN     | 2026-01-03 15:28:12.871351+00 | 
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | OPEN     | 2026-01-03 15:28:12.871351+00 | 
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | slack    | #notif-webhook               | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(10 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

################################################################################
INGEST [cpu-only-restore] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:cpu-only-restore"
}
[CHECK OK]   Ingestion 'cpu-only-restore'

--------------------------------------------------------------------------------
â±  Attente 60s pour: traitement de la restauration partielle
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 25.0       | 2026-01-03 15:29:03+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 15:22:36+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 15:29:12.910804+00 | 
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:28:12.871351+00 | 2026-01-03 15:29:12.906832+00
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 15:29:12.910804+00 | 
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:28:12.871351+00 | 2026-01-03 15:29:12.906832+00
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 9aa574d6-1f0a-4657-ac11-7342a393b9c2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.501839+00 | 2026-01-03 15:29:13.513334+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 fdceb30a-24cd-4988-9b69-316b616869d9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.502275+00 | 2026-01-03 15:29:13.509327+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 85e13fb9-385f-4536-aa1b-7b53a759fc1d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | slack    | #notif-webhook               | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.42681+00  | 2026-01-03 15:29:13.428484+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 e235f86d-9851-414e-ad73-5e65c5918cc3 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | slack    | #notif-webhook               | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.421008+00 | 2026-01-03 15:29:13.421858+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | slack    | #notif-webhook               | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(14 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '5 - NO-DATA global puis restauration partielle': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 6 - Restauration complÃ¨te aprÃ¨s partielle
################################################################################

################################################################################
INGEST [cpu-mem-full-restore] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 27
    },
    {
      "name": "memory.usage_percent",
      "value": 35
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:cpu-mem-full-restore"
}
[CHECK OK]   Ingestion 'cpu-mem-full-restore'

--------------------------------------------------------------------------------
â±  Attente 60s pour: traitement de la restauration complÃ¨te
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 27.0       | 2026-01-03 15:30:05+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 35.0       | 2026-01-03 15:30:05+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:29:12.910804+00 | 2026-01-03 15:30:12.888152+00
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:28:12.871351+00 | 2026-01-03 15:29:12.906832+00
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS NO-DATA (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                             title                             | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:29:12.910804+00 | 2026-01-03 15:30:12.888152+00
 e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:28:12.871351+00 | 2026-01-03 15:29:12.906832+00
 63aab4ab-2e3f-4eed-a424-044d04f88d7c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | debian-dev - MÃ©trique donnÃ©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 15:22:12.899986+00 | 2026-01-03 15:23:12.874126+00
 ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : pas de donnÃ©e envoyÃ©e                    | critical | RESOLVED | 2026-01-03 15:20:12.864189+00 | 2026-01-03 15:22:12.880637+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND    (    title LIKE 'Machine % : pas de donnÃ©e envoyÃ©e%'      OR title LIKE '%MÃ©trique donnÃ©e manquante :%'   )  ORDER BY created_at DESC; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 e8250cb8-9d76-4dbc-938f-de56185713dc | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.403536+00 | 2026-01-03 15:30:13.405884+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 90366e40-a24d-436a-8593-6bb7310192bf | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | slack    | #notif-webhook               | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.367579+00 | 2026-01-03 15:30:13.369032+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 9aa574d6-1f0a-4657-ac11-7342a393b9c2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.501839+00 | 2026-01-03 15:29:13.513334+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 fdceb30a-24cd-4988-9b69-316b616869d9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.502275+00 | 2026-01-03 15:29:13.509327+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 85e13fb9-385f-4536-aa1b-7b53a759fc1d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |          | slack    | #notif-webhook               | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.42681+00  | 2026-01-03 15:29:13.428484+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 e235f86d-9851-414e-ad73-5e65c5918cc3 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | slack    | #notif-webhook               | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.421008+00 | 2026-01-03 15:29:13.421858+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |          | slack    | #notif-webhook               | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |          | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |          |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |          | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |          |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(16 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '6 - Restauration complÃ¨te aprÃ¨s partielle': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 7 - Seuil CPU dÃ©passÃ©
################################################################################

################################################################################
INGEST [threshold-cpu-high] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:threshold-cpu-high"
}
[CHECK OK]   Ingestion 'threshold-cpu-high'

--------------------------------------------------------------------------------
â±  Attente 60s pour: Ã©valuation des seuils CPU high
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 95.0       | 2026-01-03 15:31:08+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 15:31:08+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                          title                           | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------+----------+--------+-------------------------------+-------------
 551f765d-36c3-48d1-a042-128cae87362a | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : Seuil dÃ©passÃ© sur cpu.usage_percent | warning  | OPEN   | 2026-01-03 15:31:08.399082+00 | 
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC; (exit_code=0)

âš ï¸  Ã‰TAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          | status | severity | current_value |         triggered_at          | resolved_at |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+--------+----------+---------------+-------------------------------+-------------+-------------------------------
 edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | 6721dc91-bb8e-4881-8e12-3bb49f3fce28 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | FIRING | warning  | 95.0          | 2026-01-03 15:31:08.391558+00 |             | 2026-01-03 15:31:08.393851+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 524869e2-16da-4aed-bfc1-49a2d41fc8b5 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | email    | frederic.gilgarcia@gmail.com | success | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:09.005291+00 | 2026-01-03 15:31:09.02043+00
 0fdf7f3b-d979-4cac-89fb-d3415d6f6842 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | slack    | #notif-webhook               | success | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:08.97891+00  | 2026-01-03 15:31:08.980376+00
 e8250cb8-9d76-4dbc-938f-de56185713dc | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.403536+00 | 2026-01-03 15:30:13.405884+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 90366e40-a24d-436a-8593-6bb7310192bf | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.367579+00 | 2026-01-03 15:30:13.369032+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 9aa574d6-1f0a-4657-ac11-7342a393b9c2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.501839+00 | 2026-01-03 15:29:13.513334+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 fdceb30a-24cd-4988-9b69-316b616869d9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.502275+00 | 2026-01-03 15:29:13.509327+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 85e13fb9-385f-4536-aa1b-7b53a759fc1d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.42681+00  | 2026-01-03 15:29:13.428484+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 e235f86d-9851-414e-ad73-5e65c5918cc3 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.421008+00 | 2026-01-03 15:29:13.421858+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(18 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold OPEN exactly 1 (cpu.usage_percent): count=1 (expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte FIRING exactly 1 (cpu.usage_percent): count=1 (expected=1)

################################################################################
INGEST [threshold-cpu-high-repeat] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 96
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:threshold-cpu-high-repeat"
}
[CHECK OK]   Ingestion 'threshold-cpu-high-repeat'

--------------------------------------------------------------------------------
â±  Attente 60s pour: re-check seuil (doit rÃ©utiliser l'incident)
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold OPEN exactly 1 (cpu.usage_percent): count=1 (expected=1)

>>> RÃ©sultat du scÃ©nario '7 - Seuil CPU dÃ©passÃ©': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 8 - Seuils revenus Ã  la normale
################################################################################

################################################################################
INGEST [threshold-all-ok] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:threshold-all-ok"
}
[CHECK OK]   Ingestion 'threshold-all-ok'

--------------------------------------------------------------------------------
â±  Attente 60s pour: rÃ©solution des alertes de seuil
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


ðŸ“Š Ã‰TAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 15:33:14+00
 5c2ed48d-64c6-4279-8642-59604a69ef78 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | memory.usage_percent | t                   | t               | f         | 25.0       | 2026-01-03 15:33:14+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

ðŸš¨ Ã‰TAT DES INCIDENTS DE SEUIL (refacto)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                          title                           | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 551f765d-36c3-48d1-a042-128cae87362a | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | Machine debian-dev : Seuil dÃ©passÃ© sur cpu.usage_percent | warning  | RESOLVED | 2026-01-03 15:31:08.399082+00 | 2026-01-03 15:33:14.757337+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE 'Machine % : Seuil dÃ©passÃ© sur %' ORDER BY created_at DESC; (exit_code=0)

âš ï¸  Ã‰TAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          |  status  | severity | current_value |         triggered_at          |          resolved_at          |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+---------------+-------------------------------+-------------------------------+-------------------------------
 edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | 6721dc91-bb8e-4881-8e12-3bb49f3fce28 | 9a9a8aba-7395-4162-af34-4b1188c1fc7a | 8aa32ded-a495-43b8-87c0-6d0dd31c00f8 | RESOLVED | warning  | 95.0          | 2026-01-03 15:31:08.391558+00 | 2026-01-03 15:33:14.741296+00 | 2026-01-03 15:31:08.393851+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 42793c2b-af1f-413b-a687-a713c326b864 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) âœ… Machine debian-dev : Seuil cpu.usage_percent retour Ã  la normale: Machine: debian-dev                                                                                   +| 2026-01-03 15:33:15.40162+00  | 2026-01-03 15:33:15.403453+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re valeur observÃ©e: 20.0                                                                                                                                                     |                               | 
 4d94ec23-a443-4874-8d2b-54d05dc1c57f | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a |                                      | slack    | #notif-webhook               | success | (#005) âœ… Machine debian-dev : Seuil cpu.usage_percent retour Ã  la normale: Machine: debian-dev                                                                                   +| 2026-01-03 15:33:15.377826+00 | 2026-01-03 15:33:15.378379+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re valeur observÃ©e: 20.0                                                                                                                                                     |                               | 
 524869e2-16da-4aed-bfc1-49a2d41fc8b5 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | email    | frederic.gilgarcia@gmail.com | success | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:09.005291+00 | 2026-01-03 15:31:09.02043+00
 0fdf7f3b-d979-4cac-89fb-d3415d6f6842 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | slack    | #notif-webhook               | success | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:08.97891+00  | 2026-01-03 15:31:08.980376+00
 e8250cb8-9d76-4dbc-938f-de56185713dc | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.403536+00 | 2026-01-03 15:30:13.405884+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 90366e40-a24d-436a-8593-6bb7310192bf | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.367579+00 | 2026-01-03 15:30:13.369032+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 9aa574d6-1f0a-4657-ac11-7342a393b9c2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.501839+00 | 2026-01-03 15:29:13.513334+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 fdceb30a-24cd-4988-9b69-316b616869d9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.502275+00 | 2026-01-03 15:29:13.509327+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 85e13fb9-385f-4536-aa1b-7b53a759fc1d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.42681+00  | 2026-01-03 15:29:13.428484+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 e235f86d-9851-414e-ad73-5e65c5918cc3 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.421008+00 | 2026-01-03 15:29:13.421858+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 8c3b420e-bc38-485b-86da-f712c1530858 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.47397+00  | 2026-01-03 15:23:13.48344+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 fc6f7a47-39f7-4a3d-a64b-1722a826f944 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | slack    | #notif-webhook               | success | (#002) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:23:13.395308+00 | 2026-01-03 15:23:13.396156+00
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                    |                               | 
 f38be72c-6347-4043-b45e-00b4e0f4156c | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.465053+00 | 2026-01-03 15:22:13.468146+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 1a4d7f99-471d-4df2-b4c5-0d910d28f2e6 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.45576+00  | 2026-01-03 15:22:13.467639+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 d8eb163c-efbe-4590-a415-d7dd36343cff | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | slack    | #notif-webhook               | success | (#001) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:22:13.397138+00 | 2026-01-03 15:22:13.398707+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5ae7f4e5-c9a7-44b1-ad50-369ab0a75eb4 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 63aab4ab-2e3f-4eed-a424-044d04f88d7c |                                      | slack    | #notif-webhook               | success | (#002) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:22:13.390836+00 | 2026-01-03 15:22:13.397778+00
                                      |                                      |                                      |                                      |          |                              |         | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re mise Ã  jour: 2026-01-03T15:14:31+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Ã‚ge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 daad0186-afff-4f3b-bb13-840580d86bec | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.442954+00 | 2026-01-03 15:20:13.444561+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 d16b9f3c-ca04-4e4c-9cc3-8da78796a028 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | ab91d3e7-8b8b-4b51-9eaf-09fd2e84a754 |                                      | slack    | #notif-webhook               | success | (#001) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:20:13.3979+00   | 2026-01-03 15:20:13.409178+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | DerniÃ¨re activitÃ© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ;
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND    title LIKE 'Machine % : Seuil dÃ©passÃ© sur %'   AND title LIKE '%cpu.usage_percent%' ; (exit_code=0)
[CHECK OK]   Incident threshold NOT OPEN (cpu.usage_percent): count=0 (expected=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte NOT FIRING (cpu.usage_percent): count=0 (expected=0)

>>> RÃ©sultat du scÃ©nario '8 - Seuils revenus Ã  la normale': SUCCESS âœ…


################################################################################
#  SCÃ‰NARIO : 9 - Email rappel incidents ouverts
################################################################################

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM clients WHERE name = 'Dev' LIMIT 1;
================================================================================
119f0943-14a2-49ac-859f-2f3f7611bd1f
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM clients WHERE name = 'Dev' LIMIT 1; (exit_code=0)

################################################################################
INGEST [reminder-open-breach] â†’ http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_161431_c372785d:reminder-open-breach"
}
[CHECK OK]   Ingestion 'reminder-open-breach'

--------------------------------------------------------------------------------
â±  Attente 60s pour: ouvrir un incident (prÃ©condition reminder)
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
â±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'; (exit_code=0)
[CHECK OK]   PrÃ©condition: au moins 1 incident OPEN: count=1 (min_expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = FALSE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM incidents WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN' ORDER BY created_at DESC LIMIT 1;
================================================================================
268766f0-8b38-4fc6-9c09-59747a7cc679
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM incidents WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN' ORDER BY created_at DESC LIMIT 1; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 1', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 15:35:23,627 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 1', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
4
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Notif non-groupÃ©e: trace slack/email/system (incident_id): count=4 (>= 1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 2 (should cooldown)', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 15:35:27,161 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 2 (should cooldown)', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider = 'cooldown'   AND status = 'skipped_cooldown'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Notif non-groupÃ©e: skipped_cooldown (incident_id): count=1 (>= 1)

--------------------------------------------------------------------------------
â±  Attente 7s pour: attendre > cooldown (5s) pour re-envoyer
--------------------------------------------------------------------------------
  ... 7 s restantes
â±  Fin de l'attente.


================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 3 (after cooldown)', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify')
================================================================================
STDERR: 2026-01-03 15:35:37,701 DEBUG celery.utils.functional 
def notify(self, payload):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify; payload = {'title': 'ðŸ”” Rappel NON-GROUPÃ‰ (test e2e)', 'text': 'ping 3 (after cooldown)', 'severity': 'warning', 'client_id': '119f0943-14a2-49ac-859f-2f3f7611bd1f', 'incident_id': '268766f0-8b38-4fc6-9c09-59747a7cc679', 'alert_id': None}; notify.apply_async(kwargs={'payload': payload}, queue='notify') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
6
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND incident_id = '268766f0-8b38-4fc6-9c09-59747a7cc679'   AND provider IN ('slack','email','system')   AND status IN (     'success',     'failed',     'skipped_no_webhook',     'skipped_no_recipient',     'skipped_no_channels'   )   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK OK]   Notif non-groupÃ©e: trace slack/email/system (incident_id): count=6 (>= 1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = TRUE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev');
================================================================================
UPDATE 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE client_settings SET alert_grouping_enabled = TRUE,     updated_at = NOW() WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev'); (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify_grouped_reminder; notify_grouped_reminder.delay('119f0943-14a2-49ac-859f-2f3f7611bd1f')
================================================================================
STDERR: 2026-01-03 15:35:41,980 DEBUG celery.utils.functional 
def notify_grouped_reminder(client_id):
    return 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T api python -c from app.workers.tasks.notification_tasks import notify_grouped_reminder; notify_grouped_reminder.delay('119f0943-14a2-49ac-859f-2f3f7611bd1f') (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM notification_log WHERE client_id = '119f0943-14a2-49ac-859f-2f3f7611bd1f'   AND status = 'success'   AND sent_at IS NOT NULL   AND message ILIKE '%Rappel d''incidents ouverts%'   AND created_at > (NOW() AT TIME ZONE 'UTC') - INTERVAL '10 minutes'; (exit_code=0)
[CHECK FAIL] Rappel GROUPÃ‰ envoyÃ© (slack/email): timeout after 90s (last_count=0)

âœ‰ï¸  DERNIÃˆRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           |      status      |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 2d15d4d8-5aab-4da4-a65f-c22aed526afa | 119f0943-14a2-49ac-859f-2f3f7611bd1f |                                      |                                      | cooldown |                              | skipped_cooldown | ðŸ” Rappel d'incidents ouverts: ðŸš¨ Rappel: incidents toujours ouverts                                                                                                              +|                               | 2026-01-03 15:35:42.257343+00
                                      |                                      |                                      |                                      |          |                              |                  | - (#006) Machine debian-dev : Seuil dÃ©passÃ© sur cpu.usage_percent                                                                                                                  |                               | 
 dd6f7884-dd34-42c0-90b2-d485bbe470e9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#006) ðŸ”” Rappel NON-GROUPÃ‰ (test e2e): ping 3 (after cooldown)                                                                                                                    | 2026-01-03 15:35:38.316566+00 | 2026-01-03 15:35:38.317992+00
 8f8d0507-1522-4f8f-8fc9-fd4cc27a1c74 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 |                                      | slack    | #notif-webhook               | success          | (#006) ðŸ”” Rappel NON-GROUPÃ‰ (test e2e): ping 3 (after cooldown)                                                                                                                    | 2026-01-03 15:35:38.293014+00 | 2026-01-03 15:35:38.29363+00
 8aabe483-813f-469a-b2d4-0699a74dab73 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 |                                      | cooldown |                              | skipped_cooldown | ðŸ”” Rappel NON-GROUPÃ‰ (test e2e): ping 2 (should cooldown)                                                                                                                          |                               | 2026-01-03 15:35:27.368887+00
 f552ee1d-de08-4c78-9115-9bf30c96e103 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#006) ðŸ”” Rappel NON-GROUPÃ‰ (test e2e): ping 1                                                                                                                                     | 2026-01-03 15:35:24.349726+00 | 2026-01-03 15:35:24.352039+00
 d2cf144e-c115-472f-846b-1df7d65cd8d2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 |                                      | slack    | #notif-webhook               | success          | (#006) ðŸ”” Rappel NON-GROUPÃ‰ (test e2e): ping 1                                                                                                                                     | 2026-01-03 15:35:24.322742+00 | 2026-01-03 15:35:24.323124+00
 91a64325-7a94-4d2c-96ac-191322bbdc5d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 | a43f0ce2-804f-46e0-ad80-959db8f67b81 | email    | frederic.gilgarcia@gmail.com | success          | (#006) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:34:19.723343+00 | 2026-01-03 15:34:19.734913+00
 8e6c61c6-a8d9-4595-af53-74b40c63c2cc | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 268766f0-8b38-4fc6-9c09-59747a7cc679 | a43f0ce2-804f-46e0-ad80-959db8f67b81 | slack    | #notif-webhook               | success          | (#006) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:34:19.634895+00 | 2026-01-03 15:34:19.63545+00
 42793c2b-af1f-413b-a687-a713c326b864 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#005) âœ… Machine debian-dev : Seuil cpu.usage_percent retour Ã  la normale: Machine: debian-dev                                                                                   +| 2026-01-03 15:33:15.40162+00  | 2026-01-03 15:33:15.403453+00
                                      |                                      |                                      |                                      |          |                              |                  | MÃ©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re valeur observÃ©e: 20.0                                                                                                                                                     |                               | 
 4d94ec23-a443-4874-8d2b-54d05dc1c57f | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a |                                      | slack    | #notif-webhook               | success          | (#005) âœ… Machine debian-dev : Seuil cpu.usage_percent retour Ã  la normale: Machine: debian-dev                                                                                   +| 2026-01-03 15:33:15.377826+00 | 2026-01-03 15:33:15.378379+00
                                      |                                      |                                      |                                      |          |                              |                  | MÃ©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re valeur observÃ©e: 20.0                                                                                                                                                     |                               | 
 524869e2-16da-4aed-bfc1-49a2d41fc8b5 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | email    | frederic.gilgarcia@gmail.com | success          | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:09.005291+00 | 2026-01-03 15:31:09.02043+00
 0fdf7f3b-d979-4cac-89fb-d3415d6f6842 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 551f765d-36c3-48d1-a042-128cae87362a | edccc6a2-7e33-48f4-97cc-0c1904a1bcdd | slack    | #notif-webhook               | success          | (#005) ðŸš¨ Alerte WARNING : cpu.usage_percent: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                               | 2026-01-03 15:31:08.97891+00  | 2026-01-03 15:31:08.980376+00
 e8250cb8-9d76-4dbc-938f-de56185713dc | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.403536+00 | 2026-01-03 15:30:13.405884+00
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 90366e40-a24d-436a-8593-6bb7310192bf | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success          | (#004) âœ… [debian-dev] : donnÃ©e de la mÃ©trique 'memory.usage_percent' restaurÃ©e: La mÃ©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donnÃ©es rÃ©centes.+| 2026-01-03 15:30:13.367579+00 | 2026-01-03 15:30:13.369032+00
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re mise Ã  jour: 2026-01-03T15:30:05+00:00                                                                                                                                    |                               | 
 9aa574d6-1f0a-4657-ac11-7342a393b9c2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.501839+00 | 2026-01-03 15:29:13.513334+00
                                      |                                      |                                      |                                      |          |                              |                  | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 fdceb30a-24cd-4988-9b69-316b616869d9 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.502275+00 | 2026-01-03 15:29:13.509327+00
                                      |                                      |                                      |                                      |          |                              |                  | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 85e13fb9-385f-4536-aa1b-7b53a759fc1d | 119f0943-14a2-49ac-859f-2f3f7611bd1f | 4d6ca2b5-136e-4208-b05f-a9d8bbbf09d2 |                                      | slack    | #notif-webhook               | success          | (#004) ðŸš¨ [debian-dev] : mÃ©trique memory.usage_percent donnÃ©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 15:29:13.42681+00  | 2026-01-03 15:29:13.428484+00
                                      |                                      |                                      |                                      |          |                              |                  | MÃ©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re mise Ã  jour: 2026-01-03T15:22:36+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | Ã‚ge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 e235f86d-9851-414e-ad73-5e65c5918cc3 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success          | (#003) âœ… debian-dev : machine opÃ©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 15:29:13.421008+00 | 2026-01-03 15:29:13.421858+00
                                      |                                      |                                      |                                      |          |                              |                  | La machine envoie Ã  nouveau des donnÃ©es, mais les mÃ©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 5c5b9829-173e-40ca-af2c-449ec6ac42f2 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | email    | frederic.gilgarcia@gmail.com | success          | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.46407+00  | 2026-01-03 15:28:13.465673+00
                                      |                                      |                                      |                                      |          |                              |                  | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 ab762f35-d346-4ffb-8d72-26b7863fb6a0 | 119f0943-14a2-49ac-859f-2f3f7611bd1f | e559ee15-fdd7-445f-a6e7-a727ee2e4ac8 |                                      | slack    | #notif-webhook               | success          | (#003) ðŸš¨ [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 15:28:13.361534+00 | 2026-01-03 15:28:13.363447+00
                                      |                                      |                                      |                                      |          |                              |                  | Toutes les mÃ©triques actives non mises en pause sont sans donnÃ©es rÃ©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |                  | DerniÃ¨re activitÃ© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> RÃ©sultat du scÃ©nario '9 - Email rappel incidents ouverts': FAIL âŒ


################################################################################
#  RÃ‰SUMÃ‰ GLOBAL DES SCÃ‰NARIOS
################################################################################

ScÃ©narios exÃ©cutÃ©s : 10
  - SUCCESS : 9
  - FAIL    : 1

  - 0 - Configuration initiale (SETUP): SUCCESS âœ…
  - 1 - Onboarding CPU: SUCCESS âœ…
  - 2 - NO-DATA machine DOWN: SUCCESS âœ…
  - 3 - Restauration complÃ¨te machine: SUCCESS âœ…
  - 4 - Ajout memory.usage_percent: SUCCESS âœ…
  - 5 - NO-DATA global puis restauration partielle: SUCCESS âœ…
  - 6 - Restauration complÃ¨te aprÃ¨s partielle: SUCCESS âœ…
  - 7 - Seuil CPU dÃ©passÃ©: SUCCESS âœ…
  - 8 - Seuils revenus Ã  la normale: SUCCESS âœ…
  - 9 - Email rappel incidents ouverts: FAIL âŒ

--------------------------------------------------------------------------------
#  STATISTIQUES DES CHECKS (commandes HTTP/SQL)
--------------------------------------------------------------------------------
Checks totaux   : 105
Checks OK       : 104
Checks en Ã©chec : 1
Taux de succÃ¨s  : 99.05 %

#  FIN DU SCÃ‰NARIO COMPLET
################################################################################

