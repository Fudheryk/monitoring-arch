
################################################################################
#  SC√âNARIO MATRICE ALERTES / NO-DATA (cpu.usage_percent + memory.usage_percent)
#  Machine : debian-dev
#  Client  : Dev
#  Fingerprint : f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1
################################################################################

################################################################################
#  SC√âNARIO : 0 - Configuration initiale (SETUP)
################################################################################

üîß Configuration initiale de la machine et des seuils...

################################################################################
INGEST [setup-initial] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:setup-initial"
}
[CHECK OK]   Ingestion 'setup-initial'

--------------------------------------------------------------------------------
‚è±  Attente 30s pour: cr√©ation des metric_instances
--------------------------------------------------------------------------------
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üîß ACTIVATION DE L'ALERTING SUR LES M√âTRIQUES

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') );
================================================================================
UPDATE 2
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c UPDATE metric_instances SET is_alerting_enabled = true WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ); (exit_code=0)

üîß CR√âATION DU SEUIL POUR cpu.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent';
================================================================================
6761a8eb-4d21-44bc-9f43-057174da1adf
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'cpu.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '6761a8eb-4d21-44bc-9f43-057174da1adf' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '6761a8eb-4d21-44bc-9f43-057174da1adf' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour cpu.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '6761a8eb-4d21-44bc-9f43-057174da1adf',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '6761a8eb-4d21-44bc-9f43-057174da1adf',     'default',     'gt',     80.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT cpu.usage_percent

üîß CR√âATION DU SEUIL POUR memory.usage_percent

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent';
================================================================================
0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT id FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND name_effective = 'memory.usage_percent'; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4' AND name = 'default';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM thresholds_new WHERE metric_instance_id = '0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4' AND name = 'default'; (exit_code=0)
‚ÑπÔ∏è  Cr√©ation d'un nouveau seuil DEFAULT pour memory.usage_percent...

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() );
================================================================================
INSERT 0 1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c INSERT INTO thresholds_new (     id, metric_instance_id, name, condition, value_num,     severity, is_active, consecutive_breaches, created_at, updated_at ) VALUES (     gen_random_uuid(),     '0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4',     'default',     'gt',     85.0,     'warning',     true,     1,     NOW(),     NOW() ); (exit_code=0)
[CHECK OK]   Configuration seuil DEFAULT memory.usage_percent

üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 07:08:19+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 07:08:19+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

‚öôÔ∏è  SEUILS CONFIGUR√âS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name;
================================================================================
                  id                  |    name_effective    |  name   | condition | value_num | severity | is_active |          created_at           
--------------------------------------+----------------------+---------+-----------+-----------+----------+-----------+-------------------------------
 b3099487-5578-46e9-9186-6b1287141d88 | cpu.usage_percent    | default | gt        |        80 | warning  | t         | 2026-01-03 07:08:51.823051+00
 7fbac538-3ed1-4e39-a936-b12a20594d01 | memory.usage_percent | default | gt        |        85 | warning  | t         | 2026-01-03 07:08:54.82244+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT t.id, mi.name_effective, t.name, t.condition, t.value_num,        t.severity, t.is_active, t.created_at FROM thresholds_new t JOIN metric_instances mi ON mi.id = t.metric_instance_id WHERE mi.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY mi.name_effective, t.name; (exit_code=0)

>>> R√©sultat du sc√©nario '0 - Configuration initiale (SETUP)': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 1 - Onboarding CPU
################################################################################

################################################################################
INGEST [cpu-onboarding-1] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 42
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:cpu-onboarding-1"
}
[CHECK OK]   Ingestion 'cpu-onboarding-1'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser l'ingestion √™tre trait√©e
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 07:08:55+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 07:08:19+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
 id | threshold_id | machine_id | metric_instance_id | status | severity | current_value | triggered_at | resolved_at | created_at 
----+--------------+------------+--------------------+--------+----------+---------------+--------------+-------------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
 id | client_id | incident_id | alert_id | provider | recipient | status | message | sent_at | created_at 
----+-----------+-------------+----------+----------+-----------+--------+---------+---------+------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '1 - Onboarding CPU': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 2 - NO-DATA machine DOWN
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: laisser NO-DATA se d√©clencher (machine DOWN)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 42.0       | 2026-01-03 07:08:55+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 07:08:19+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                       title                       | severity | status |          created_at           | resolved_at 
--------------------------------------+--------------------------------------+--------------------------------------+---------------------------------------------------+----------+--------+-------------------------------+-------------
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e | critical | OPEN   | 2026-01-03 07:15:00.10132+00  | 
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e | critical | OPEN   | 2026-01-03 07:14:00.118936+00 | 
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                   message                                   |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+-----------------------------------------------------------------------------+-------------------------------+-------------------------------
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev   +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.+|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                |                               | 
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '2 - NO-DATA machine DOWN': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 3 - Restauration compl√®te machine
################################################################################

################################################################################
INGEST [cpu-restore-full] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:cpu-restore-full"
}
[CHECK OK]   Ingestion 'cpu-restore-full'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: laisser freshness/evaluate traiter la restauration
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 30.0       | 2026-01-03 07:15:21+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 07:08:19+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 6f006be4-089b-46a5-a10d-6853abbf650e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 07:16:00.114351+00 | 
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:15:00.10132+00  | 2026-01-03 07:16:00.108087+00
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:14:00.118936+00 | 2026-01-03 07:15:21.538365+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                       message                                                        |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+----------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                        +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                               |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                        +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                      +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                     +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                               |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                      +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent. |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                      +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                    |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                      +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                    |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                         |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                         |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                         |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                            +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                         +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                         |                               | 
(10 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '3 - Restauration compl√®te machine': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 4 - Ajout memory.usage_percent
################################################################################

################################################################################
INGEST [cpu-mem-onboarding] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 35
    },
    {
      "name": "memory.usage_percent",
      "value": 40
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:cpu-mem-onboarding"
}
[CHECK OK]   Ingestion 'cpu-mem-onboarding'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de l'ingestion CPU+MEM
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 07:16:24+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 07:16:24+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 6f006be4-089b-46a5-a10d-6853abbf650e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 07:16:00.114351+00 | 2026-01-03 07:17:00.125954+00
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:15:00.10132+00  | 2026-01-03 07:16:00.108087+00
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:14:00.118936+00 | 2026-01-03 07:15:21.538365+00
(3 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(12 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '4 - Ajout memory.usage_percent': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 5 - NO-DATA global puis restauration partielle
################################################################################

--------------------------------------------------------------------------------
‚è±  Attente 320s pour: NO-DATA global (CPU + MEM)
--------------------------------------------------------------------------------
  ... 320 s restantes
  ... 310 s restantes
  ... 300 s restantes
  ... 290 s restantes
  ... 280 s restantes
  ... 270 s restantes
  ... 260 s restantes
  ... 250 s restantes
  ... 240 s restantes
  ... 230 s restantes
  ... 220 s restantes
  ... 210 s restantes
  ... 200 s restantes
  ... 190 s restantes
  ... 180 s restantes
  ... 170 s restantes
  ... 160 s restantes
  ... 150 s restantes
  ... 140 s restantes
  ... 130 s restantes
  ... 120 s restantes
  ... 110 s restantes
  ... 100 s restantes
  ... 90 s restantes
  ... 80 s restantes
  ... 70 s restantes
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 35.0       | 2026-01-03 07:16:24+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 07:16:24+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 3f1b1f4d-6473-481b-92ae-b5339218e132 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | OPEN     | 2026-01-03 07:22:00.106489+00 | 
 6f006be4-089b-46a5-a10d-6853abbf650e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 07:16:00.114351+00 | 2026-01-03 07:17:00.125954+00
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:15:00.10132+00  | 2026-01-03 07:16:00.108087+00
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:14:00.118936+00 | 2026-01-03 07:15:21.538365+00
(4 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 2dc5a899-c31d-4584-9544-5fb9073d1630 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.617533+00 | 2026-01-03 07:22:00.620032+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 3c13bc43-bde9-4519-b0ac-c89df1ef2085 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.597642+00 | 2026-01-03 07:22:00.59877+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(14 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

################################################################################
INGEST [cpu-only-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:cpu-only-restore"
}
[CHECK OK]   Ingestion 'cpu-only-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration partielle
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 25.0       | 2026-01-03 07:22:50+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 40.0       | 2026-01-03 07:16:24+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | OPEN     | 2026-01-03 07:23:00.13279+00  | 
 3f1b1f4d-6473-481b-92ae-b5339218e132 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:22:00.106489+00 | 2026-01-03 07:22:51.007876+00
 6f006be4-089b-46a5-a10d-6853abbf650e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 07:16:00.114351+00 | 2026-01-03 07:17:00.125954+00
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:15:00.10132+00  | 2026-01-03 07:16:00.108087+00
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:14:00.118936+00 | 2026-01-03 07:15:21.538365+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 ca2b3eed-4d81-47d5-bae8-cd0b5177d05b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.710795+00 | 2026-01-03 07:23:00.716738+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 ee912aa8-6a27-4e43-b7bf-c716884e3e5e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | slack    | #notif-webhook               | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.669491+00 | 2026-01-03 07:23:00.675653+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 3b917b8a-9a5a-4c97-a096-0d3366e78f34 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.534737+00 | 2026-01-03 07:22:51.550329+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 49544e36-a58b-46b1-b5f7-d13c0999344e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.48755+00  | 2026-01-03 07:22:51.488121+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 2dc5a899-c31d-4584-9544-5fb9073d1630 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.617533+00 | 2026-01-03 07:22:00.620032+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 3c13bc43-bde9-4519-b0ac-c89df1ef2085 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.597642+00 | 2026-01-03 07:22:00.59877+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(18 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '5 - NO-DATA global puis restauration partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 6 - Restauration compl√®te apr√®s partielle
################################################################################

################################################################################
INGEST [cpu-mem-full-restore] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 27
    },
    {
      "name": "memory.usage_percent",
      "value": 35
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:cpu-mem-full-restore"
}
[CHECK OK]   Ingestion 'cpu-mem-full-restore'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: traitement de la restauration compl√®te
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 27.0       | 2026-01-03 07:23:53+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 35.0       | 2026-01-03 07:23:53+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS (machine)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC;
================================================================================
                  id                  |              client_id               |              machine_id              |                                title                                 | severity |  status  |          created_at           |          resolved_at          
--------------------------------------+--------------------------------------+--------------------------------------+----------------------------------------------------------------------+----------+----------+-------------------------------+-------------------------------
 fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#005) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 07:23:00.13279+00  | 2026-01-03 07:24:00.114764+00
 3f1b1f4d-6473-481b-92ae-b5339218e132 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#004) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:22:00.106489+00 | 2026-01-03 07:22:51.007876+00
 6f006be4-089b-46a5-a10d-6853abbf650e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#003) debian-dev - M√©trique donn√©e manquante : memory.usage_percent | error    | RESOLVED | 2026-01-03 07:16:00.114351+00 | 2026-01-03 07:17:00.125954+00
 fd62dab4-30cd-45bb-b1f2-35123422cca4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#002) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:15:00.10132+00  | 2026-01-03 07:16:00.108087+00
 be64a74d-ec86-4d9a-bd61-8947d21cb529 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | (#001) Machine debian-dev : pas de donn√©e envoy√©e                    | critical | RESOLVED | 2026-01-03 07:14:00.118936+00 | 2026-01-03 07:15:21.538365+00
(5 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC; (exit_code=0)

üö® √âTAT DES INCIDENTS 'Metric no data'

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%Metric no data%' ORDER BY created_at DESC; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              | alert_id | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 0e02eae2-ada6-490d-994e-f7da80c015ac | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.702153+00 | 2026-01-03 07:24:00.703082+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 086fc6af-7736-419d-a7be-69e1fe8ba88b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.64192+00  | 2026-01-03 07:24:00.642892+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 ca2b3eed-4d81-47d5-bae8-cd0b5177d05b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.710795+00 | 2026-01-03 07:23:00.716738+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 ee912aa8-6a27-4e43-b7bf-c716884e3e5e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |          | slack    | #notif-webhook               | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.669491+00 | 2026-01-03 07:23:00.675653+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 3b917b8a-9a5a-4c97-a096-0d3366e78f34 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.534737+00 | 2026-01-03 07:22:51.550329+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 49544e36-a58b-46b1-b5f7-d13c0999344e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.48755+00  | 2026-01-03 07:22:51.488121+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 2dc5a899-c31d-4584-9544-5fb9073d1630 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.617533+00 | 2026-01-03 07:22:00.620032+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 3c13bc43-bde9-4519-b0ac-c89df1ef2085 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |          | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.597642+00 | 2026-01-03 07:22:00.59877+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |          | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |          |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |          |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |          |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |          | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 bcf2905d-71b6-4aeb-b70b-0f542a78d66a | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | email    | frederic.gilgarcia@gmail.com | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.748496+00 | 2026-01-03 07:14:00.751873+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
 7b364eb6-0a99-431a-a42a-21c8f552d192 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |          | slack    | #notif-webhook               | success | (#001) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:14:00.714245+00 | 2026-01-03 07:14:00.719535+00
                                      |                                      |                                      |          |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |          |          |                              |         | Derni√®re activit√© connue: 341s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

>>> R√©sultat du sc√©nario '6 - Restauration compl√®te apr√®s partielle': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 7 - Seuil CPU d√©pass√©
################################################################################

################################################################################
INGEST [threshold-cpu-high] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 95
    },
    {
      "name": "memory.usage_percent",
      "value": 30
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:threshold-cpu-high"
}
[CHECK OK]   Ingestion 'threshold-cpu-high'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: √©valuation des seuils CPU high
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 95.0       | 2026-01-03 07:24:55+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 30.0       | 2026-01-03 07:24:55+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          | status | severity | current_value |         triggered_at         | resolved_at |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+--------+----------+---------------+------------------------------+-------------+-------------------------------
 c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | b3099487-5578-46e9-9186-6b1287141d88 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | 6761a8eb-4d21-44bc-9f43-057174da1adf | FIRING | warning  | 95.0          | 2026-01-03 07:24:55.75748+00 |             | 2026-01-03 07:24:55.758639+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 1559108b-4fab-41dc-a712-6e12ed22aebc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 |                                      | c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                                                          | 2026-01-03 07:24:56.340596+00 | 2026-01-03 07:24:56.344604+00
 f3bee677-f426-4279-a3c0-23984df46bda | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 |                                      | c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | slack    | #notif-webhook               | success | üö® Alerte WARNING: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                                                          | 2026-01-03 07:24:56.30832+00  | 2026-01-03 07:24:56.313309+00
 0e02eae2-ada6-490d-994e-f7da80c015ac | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.702153+00 | 2026-01-03 07:24:00.703082+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 086fc6af-7736-419d-a7be-69e1fe8ba88b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.64192+00  | 2026-01-03 07:24:00.642892+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 ca2b3eed-4d81-47d5-bae8-cd0b5177d05b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.710795+00 | 2026-01-03 07:23:00.716738+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 ee912aa8-6a27-4e43-b7bf-c716884e3e5e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | slack    | #notif-webhook               | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.669491+00 | 2026-01-03 07:23:00.675653+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 3b917b8a-9a5a-4c97-a096-0d3366e78f34 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.534737+00 | 2026-01-03 07:22:51.550329+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 49544e36-a58b-46b1-b5f7-d13c0999344e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.48755+00  | 2026-01-03 07:22:51.488121+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 2dc5a899-c31d-4584-9544-5fb9073d1630 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.617533+00 | 2026-01-03 07:22:00.620032+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 3c13bc43-bde9-4519-b0ac-c89df1ef2085 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.597642+00 | 2026-01-03 07:22:00.59877+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |                                      | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 ba420aef-9a02-4cde-9281-dc2a388b04c4 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.679055+00 | 2026-01-03 07:15:00.67984+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
 8cb36baf-852f-4a19-b5ef-af59f649d640 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | slack    | #notif-webhook               | success | (#002) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:15:00.586082+00 | 2026-01-03 07:15:00.590749+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 401s (seuil 300s).                                                                                                                                       |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
7
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK OK]   Incident threshold OPEN (cpu.usage_percent): count=7 (min_expected=1)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
1
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte FIRING (cpu.usage_percent): count=1 (min_expected=1)

>>> R√©sultat du sc√©nario '7 - Seuil CPU d√©pass√©': SUCCESS ‚úÖ


################################################################################
#  SC√âNARIO : 8 - Seuils revenus √† la normale
################################################################################

################################################################################
INGEST [threshold-all-ok] ‚Üí http://localhost:8000/api/v1/ingest/metrics
################################################################################
Payload:
{
  "metadata": {
    "generator": "scenario-matrix-script",
    "version": "0.1",
    "schema_version": "1.0",
    "key": "dev-apikey-123"
  },
  "machine": {
    "hostname": "debian-dev",
    "os": "linux",
    "fingerprint": "f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1"
  },
  "metrics": [
    {
      "name": "cpu.usage_percent",
      "value": 20
    },
    {
      "name": "memory.usage_percent",
      "value": 25
    }
  ]
}
HTTP 202
{
  "status": "accepted",
  "ingest_id": "20260103_080818_484ed07d:threshold-all-ok"
}
[CHECK OK]   Ingestion 'threshold-all-ok'

--------------------------------------------------------------------------------
‚è±  Attente 60s pour: r√©solution des alertes de seuil
--------------------------------------------------------------------------------
  ... 60 s restantes
  ... 50 s restantes
  ... 40 s restantes
  ... 30 s restantes
  ... 20 s restantes
  ... 10 s restantes
‚è±  Fin de l'attente.


üìä √âTAT DES METRICS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective;
================================================================================
                  id                  |              machine_id              |    name_effective    | is_alerting_enabled | needs_threshold | is_paused | last_value |       updated_at       
--------------------------------------+--------------------------------------+----------------------+---------------------+-----------------+-----------+------------+------------------------
 6761a8eb-4d21-44bc-9f43-057174da1adf | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | cpu.usage_percent    | t                   | t               | f         | 20.0       | 2026-01-03 07:26:01+00
 0d8a8f62-9a28-456b-b5f2-d8aafff3e9d4 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | memory.usage_percent | t                   | t               | f         | 25.0       | 2026-01-03 07:26:01+00
(2 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, machine_id, name_effective, is_alerting_enabled, needs_threshold,        is_paused, last_value, updated_at FROM metric_instances WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY name_effective; (exit_code=0)

üö® √âTAT DES INCIDENTS DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC;
================================================================================
 id | client_id | machine_id | title | severity | status | created_at | resolved_at 
----+-----------+------------+-------+----------+--------+------------+-------------
(0 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, machine_id, title, severity, status,        created_at, resolved_at FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND title LIKE '%breach%' ORDER BY created_at DESC; (exit_code=0)

‚ö†Ô∏è  √âTAT DES ALERTES DE SEUIL

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50;
================================================================================
                  id                  |             threshold_id             |              machine_id              |          metric_instance_id          |  status  | severity | current_value |         triggered_at         |         resolved_at          |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+----------+---------------+------------------------------+------------------------------+-------------------------------
 c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | b3099487-5578-46e9-9186-6b1287141d88 | 40d2571c-8f4c-4e3c-ad57-0376acdb523b | 6761a8eb-4d21-44bc-9f43-057174da1adf | RESOLVED | warning  | 95.0          | 2026-01-03 07:24:55.75748+00 | 2026-01-03 07:26:01.92426+00 | 2026-01-03 07:24:55.758639+00
(1 row)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, threshold_id, machine_id, metric_instance_id, status, severity,        current_value, triggered_at, resolved_at, created_at FROM alerts WHERE machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') ) ORDER BY created_at DESC LIMIT 50; (exit_code=0)

‚úâÔ∏è  DERNI√àRES NOTIFICATIONS

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20;
================================================================================
                  id                  |              client_id               |             incident_id              |               alert_id               | provider |          recipient           | status  |                                                                                      message                                                                                       |            sent_at            |          created_at           
--------------------------------------+--------------------------------------+--------------------------------------+--------------------------------------+----------+------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------+-------------------------------
 cbaa95f0-0061-4a18-bfd5-9d87ccbe2bae | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 961c4796-2d88-4bce-81df-64fb92df57e3 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#006) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 07:26:02.717506+00 | 2026-01-03 07:26:02.719058+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 31e68166-cb15-4346-977d-74fa1e16722b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 961c4796-2d88-4bce-81df-64fb92df57e3 |                                      | slack    | #notif-webhook               | success | (#006) ‚úÖ Machine debian-dev : Seuil cpu.usage_percent retour √† la normale: Machine: debian-dev                                                                                   +| 2026-01-03 07:26:02.612506+00 | 2026-01-03 07:26:02.613271+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: cpu.usage_percent                                                                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Seuil: gt 80.0                                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re valeur observ√©e: 20.0                                                                                                                                                     |                               | 
 1559108b-4fab-41dc-a712-6e12ed22aebc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 |                                      | c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | email    | frederic.gilgarcia@gmail.com | success | üö® Alerte WARNING: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                                                          | 2026-01-03 07:24:56.340596+00 | 2026-01-03 07:24:56.344604+00
 f3bee677-f426-4279-a3c0-23984df46bda | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 |                                      | c8fa6f0b-eced-4b8f-aed6-1ae3bef6f879 | slack    | #notif-webhook               | success | üö® Alerte WARNING: cpu.usage_percent gt seuil (seuil=80.0) - Valeur: 95.0                                                                                                          | 2026-01-03 07:24:56.30832+00  | 2026-01-03 07:24:56.313309+00
 0e02eae2-ada6-490d-994e-f7da80c015ac | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.702153+00 | 2026-01-03 07:24:00.703082+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 086fc6af-7736-419d-a7be-69e1fe8ba88b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | slack    | #notif-webhook               | success | (#005) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:24:00.64192+00  | 2026-01-03 07:24:00.642892+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:23:53+00:00                                                                                                                                    |                               | 
 ca2b3eed-4d81-47d5-bae8-cd0b5177d05b | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | email    | frederic.gilgarcia@gmail.com | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.710795+00 | 2026-01-03 07:23:00.716738+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 ee912aa8-6a27-4e43-b7bf-c716884e3e5e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd91a3f4-4b98-49d2-a9c3-b71c2a4c80fa |                                      | slack    | #notif-webhook               | success | (#005) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:23:00.669491+00 | 2026-01-03 07:23:00.675653+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 396s (seuil 300s)                                                                                                                                                             |                               | 
 3b917b8a-9a5a-4c97-a096-0d3366e78f34 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.534737+00 | 2026-01-03 07:22:51.550329+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 49544e36-a58b-46b1-b5f7-d13c0999344e | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | slack    | #notif-webhook               | success | (#004) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:22:51.48755+00  | 2026-01-03 07:22:51.488121+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 2dc5a899-c31d-4584-9544-5fb9073d1630 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.617533+00 | 2026-01-03 07:22:00.620032+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 3c13bc43-bde9-4519-b0ac-c89df1ef2085 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 3f1b1f4d-6473-481b-92ae-b5339218e132 |                                      | slack    | #notif-webhook               | success | (#004) üö® [debian-dev] : machine ne communique plus: Machine: debian-dev                                                                                                          +| 2026-01-03 07:22:00.597642+00 | 2026-01-03 07:22:00.59877+00
                                      |                                      |                                      |                                      |          |                              |         | Toutes les m√©triques actives non mises en pause sont sans donn√©es r√©centes.                                                                                                       +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re activit√© connue: 336s (seuil 300s).                                                                                                                                       |                               | 
 4b696ce3-692c-41af-88d2-b9c505397d49 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.65752+00  | 2026-01-03 07:17:00.661044+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 3a3a1eae-86af-4a9d-8255-99b06355642d | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | slack    | #notif-webhook               | success | (#003) ‚úÖ [debian-dev] : donn√©e de la m√©trique 'memory.usage_percent' restaur√©e: La m√©trique 'memory.usage_percent' sur la machine 'debian-dev' a de nouveau des donn√©es r√©centes.+| 2026-01-03 07:17:00.619826+00 | 2026-01-03 07:17:00.620582+00
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:16:24+00:00                                                                                                                                    |                               | 
 ef8f8264-e1aa-410b-804e-0059628450ff | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | email    | frederic.gilgarcia@gmail.com | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.676167+00 | 2026-01-03 07:16:00.677542+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 2897c820-7231-49b2-9539-8f58e081d172 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.630075+00 | 2026-01-03 07:16:00.632641+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 b5bdde5a-a923-4962-acf0-2bda5a265ecc | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | 6f006be4-089b-46a5-a10d-6853abbf650e |                                      | slack    | #notif-webhook               | success | (#003) üö® [debian-dev] : m√©trique memory.usage_percent donn√©e manquante: Machine: debian-dev                                                                                      +| 2026-01-03 07:16:00.625952+00 | 2026-01-03 07:16:00.627528+00
                                      |                                      |                                      |                                      |          |                              |         | M√©trique: memory.usage_percent                                                                                                                                                    +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | Derni√®re mise √† jour: 2026-01-03T07:08:19+00:00                                                                                                                                   +|                               | 
                                      |                                      |                                      |                                      |          |                              |         | √Çge: 461s (seuil 300s)                                                                                                                                                             |                               | 
 4089de13-94dc-443c-99db-db674479473f | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | fd62dab4-30cd-45bb-b1f2-35123422cca4 |                                      | slack    | #notif-webhook               | success | (#002) ‚úÖ debian-dev : machine op√©rationnelle (partielle): Machine: debian-dev                                                                                                    +| 2026-01-03 07:16:00.594166+00 | 2026-01-03 07:16:00.594907+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es, mais les m√©triques suivantes sont toujours en panne : memory.usage_percent.                                                               |                               | 
 2c108e5b-d2b0-4b0f-b2ed-d71303ef0296 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |                                      | email    | frederic.gilgarcia@gmail.com | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.124943+00 | 2026-01-03 07:15:22.125612+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
 5a8ece77-77e7-428a-871c-fdfa92648477 | 18042f3a-373d-4de7-b85c-5e73bc5d6c15 | be64a74d-ec86-4d9a-bd61-8947d21cb529 |                                      | slack    | #notif-webhook               | success | (#001) ‚úÖ [debian-dev] : machine op√©rationnelle √† nouveau: Machine: debian-dev                                                                                                    +| 2026-01-03 07:15:22.063766+00 | 2026-01-03 07:15:22.064611+00
                                      |                                      |                                      |                                      |          |                              |         | La machine envoie √† nouveau des donn√©es r√©centes.                                                                                                                                  |                               | 
(20 rows)
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -c SELECT id, client_id, incident_id, alert_id, provider, recipient,        status, message, sent_at, created_at FROM notification_log WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev') ORDER BY created_at DESC LIMIT 20; (exit_code=0)

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%';
================================================================================
7
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM incidents WHERE client_id = (SELECT id FROM clients WHERE name = 'Dev')   AND machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND status = 'OPEN'   AND title LIKE '%cpu.usage_percent%'; (exit_code=0)
[CHECK FAIL] Incident threshold NOT OPEN (cpu.usage_percent): count=7

================================================================================
>> CMD: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent';
================================================================================
0
[CHECK OK]   Commande: docker compose -f docker/docker-compose.yml exec -T db psql -U postgres -d monitoring -t -A -c SELECT COUNT(*) FROM alerts a JOIN metric_instances mi ON mi.id = a.metric_instance_id WHERE a.machine_id = ( SELECT id FROM machines WHERE hostname = 'debian-dev'   AND fingerprint = 'f5355ba885eceec3b226bf1c746d7159baa891d9b47aa6d07369a47a8e4d5cc1'   AND client_id = (SELECT id FROM clients WHERE name = 'Dev') )   AND a.status = 'FIRING'   AND mi.name_effective = 'cpu.usage_percent'; (exit_code=0)
[CHECK OK]   Alerte NOT FIRING (cpu.usage_percent): count=0

>>> R√©sultat du sc√©nario '8 - Seuils revenus √† la normale': FAIL ‚ùå


################################################################################
#  R√âSUM√â GLOBAL DES SC√âNARIOS
################################################################################

Sc√©narios ex√©cut√©s : 9
  - SUCCESS : 8
  - FAIL    : 1

  - 0 - Configuration initiale (SETUP): SUCCESS ‚úÖ
  - 1 - Onboarding CPU: SUCCESS ‚úÖ
  - 2 - NO-DATA machine DOWN: SUCCESS ‚úÖ
  - 3 - Restauration compl√®te machine: SUCCESS ‚úÖ
  - 4 - Ajout memory.usage_percent: SUCCESS ‚úÖ
  - 5 - NO-DATA global puis restauration partielle: SUCCESS ‚úÖ
  - 6 - Restauration compl√®te apr√®s partielle: SUCCESS ‚úÖ
  - 7 - Seuil CPU d√©pass√©: SUCCESS ‚úÖ
  - 8 - Seuils revenus √† la normale: FAIL ‚ùå

--------------------------------------------------------------------------------
#  STATISTIQUES DES CHECKS (commandes HTTP/SQL)
--------------------------------------------------------------------------------
Checks totaux   : 64
Checks OK       : 63
Checks en √©chec : 1
Taux de succ√®s  : 98.44 %

#  FIN DU SC√âNARIO COMPLET
################################################################################

